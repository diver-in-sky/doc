


























<!doctype html>
<html>
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
  <link rel="icon" type="image/png" sizes="16x16" href=../../_static/favicon/favicon-16x16.png>
  <link rel="icon" type="image/png" sizes="32x32" href=../../_static/favicon/favicon-32x32.png>
  <link rel="icon" type="image/png" sizes="96x96" href=../../_static/favicon/favicon-96x96.png>

    <title>5. Server administration</title>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/translations.js"></script>
      <script type="text/javascript" src="../../_static/js/menu.js"></script>
      <script type="text/javascript" src="../../_static/js/mobile_menu.js"></script>
      <script type="text/javascript" src="../../_static/js/stacktable.min.js"></script>
      <script type="text/javascript" src="../../_static/js/headers.js"></script>
      <script type="text/javascript" src="../../_static/js/dropdown.js"></script>
      <script type="text/javascript" src="../../_static/js/jquery.sticky-kit.min.js"></script>
      <link rel="stylesheet" href="../../_static/design.css">

    
    <!--[if lt IE 9]>
      <script src="/js/ie8.js"></script>
      <link rel="stylesheet" href="/theme/ie8.css" />
    <![endif]-->
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-22120502-1', 'auto');
  ga('send', 'pageview');
</script>

<!-- Rating@Mail.ru counter -->
<script type="text/javascript">
  var _tmr = _tmr || [];
  _tmr.push({id: "2284916", type: "pageView", start: (new Date()).getTime()});
  (function (d, w) {
    var ts = d.createElement("script"); ts.type = "text/javascript"; ts.async = true;
    ts.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//top-fwz1.mail.ru/js/code.js";
    var f = function () {var s = d.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ts, s);};
    if (w.opera == "[object Opera]") { d.addEventListener("DOMContentLoaded", f, false); } else { f(); }
  })(document, window);
</script>
<noscript>
  <div style="position:absolute;left:-10000px;">
    <img src="//top-fwz1.mail.ru/counter?id=2284916;js=na" style="border:0;"
         height="1" width="1" alt="Рейтинг@Mail.ru" />
  </div>
</noscript>
<!-- //Rating@Mail.ru counter -->


    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:       '',
        VERSION:        '1.7.2',
        COLLAPSE_INDEX:  false,
        FILE_SUFFIX:    '.html',
        HAS_SOURCE:      true
      };
      
      
      var disqus_config = function () {
          this.page.identifier = "doc/book/administration";
          this.language        = "ru"
      };
    </script>
    

  </head>
  <body class="p-cols_design b-doc-doc/book/administration">
    <div class="b-wrapper">
      <!-- HEADER > -->
      
  <header class="b-header">
    <div class="b-header_menu_mobile">
      <div class="b-burger-button">
        <span></span>
      </div>
      <form role="search" class="b-header-search" action="../../search.html" method="get">
        <input name="q" type="search">
      </form>
    </div>
    <div class="b-menu_mobile">
      <div class="b-menu_mobile__wrapper">
        <nav class="b-header_menu">
          
  <ul class="b-menu">
    
      
      <li class="b-menu-item">
      
        <a href="../../index.html" class="b-menu-item-url">Overview</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../try.html" class="b-menu-item-url">Try</a>
      </li>
    
      
      <li class="b-menu-item p-active">
      
        <a href="../../doc.html" class="b-menu-item-url">Documentation</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../download.html" class="b-menu-item-url">Download</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../rocks.html" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

        </nav>
      </div>
    </div>
    <div class="b-header-wrapper">
      <nav class="b-header_menu">
        
  <ul class="b-menu">
    
      
      <li class="b-menu-item">
      
        <a href="../../index.html" class="b-menu-item-url">Overview</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../try.html" class="b-menu-item-url">Try</a>
      </li>
    
      
      <li class="b-menu-item p-active">
      
        <a href="../../doc.html" class="b-menu-item-url">Documentation</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../download.html" class="b-menu-item-url">Download</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../rocks.html" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

      </nav>
    </div>
  </header>

      <!-- < HEADER -->

      <div class="b-content b-clearbox">
        
  
    <section class="b-block-lightgray b-documentation_top b-clearbox p-documentation_in">
      <div class="b-block-wrapper">
        <h2 class="b-section-title b-ellipsis toggle-navigation" title="5. Server administration"> 5. Server administration </h2>
  <div class="b-doc-language_selector">
    <ul class="b-doc-language_selector-list">
    
      <li class="b-doc-language_selector-item">
      
        <a href="
  
    ../../en/doc/book/administration.html
  
"
           class="b-doc-language_selector-item-url"> En </a>
      
      </li>
    
      <li class="b-doc-language_selector-item">
      
        <a href="#" class="b-doc-language_selector-item-url p-active"> Ru </a>
      
      </li>
    
    </ul>
  </div>
</div>
    </section>
    
      <div class="b-cols_content b-clearbox">
        <div class="b-cols_content_left">
          <div class="b-menu-toc">
            
<form id="searchbox" role="search" class="search b-search" action="../../search.html" method="get">
  <input class="b-search-text" name="q" type="text"/ placeholder="Search the manual">
  <input class="b-search-but" type="submit" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../whats_new.html">What&#8217;s new?</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../whats_new.html#what-s-new-in-tarantool-1-7">What&#8217;s new in Tarantool 1.7?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#an-application-server-together-with-a-database-manager">An application server together with a database manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#database-features">Database features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/lua_tutorials.html">1. Lua tutorials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#insert-one-million-tuples-with-a-lua-stored-procedure">1.1. Insert one million tuples with a Lua stored procedure</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#configure">1.1.1. Configure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#delimiter">1.1.2. Delimiter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#create-a-function-that-returns-a-string">1.1.3. Create a function that returns a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#create-a-function-that-calls-another-function-and-sets-a-variable">1.1.4. Create a function that calls another function and sets a variable</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-the-function-so-it-returns-a-one-letter-random-string">1.1.5. Modify the function so it returns a one-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-the-function-so-it-returns-a-ten-letter-random-string">1.1.6. Modify the function so it returns a ten-letter random string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#make-a-tuple-out-of-a-number-and-a-string">1.1.7. Make a tuple out of a number and a string</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-main-function-to-insert-a-tuple-into-the-database">1.1.8. Modify main_function to insert a tuple into the database</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/lua_tutorials.html#modify-main-function-to-insert-a-million-tuples-into-the-database">1.1.9. Modify main_function to insert a million tuples into the database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#sum-a-json-field-for-all-tuples">1.2. Sum a JSON field for all tuples</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/lua_tutorials.html#indexed-pattern-search">1.3. Indexed pattern search</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/c_tutorial.html">2. C tutorial</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/c_tutorial.html#c-stored-procedures">2.1. C stored procedures</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User&#8217;s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">1. Preface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="intro.html#how-to-read-the-documentation">1.1. How to read the documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="intro.html#getting-in-touch-with-the-tarantool-community">1.2. Getting in touch with the Tarantool community</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="user_guide_getting_started.html">2. Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="user_guide_getting_started.html#downloading-and-installing-a-binary-package">2.1. Downloading and installing a binary package</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide_getting_started.html#starting-tarantool-and-making-your-first-database">2.2. Starting Tarantool and making your first database</a></li>
<li class="toctree-l3"><a class="reference internal" href="user_guide_getting_started.html#connecting-remotely">2.3. Connecting remotely</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="box/index.html">3. Database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#data-model">3.1. Data model</a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#space">3.1.1. Space</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#tuple-set">3.1.2. Tuple set</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#index">3.1.3. Index</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#data-types">3.1.4. Data types</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#operations">3.1.5. Operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#persistence">3.1.6. Persistence</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#data-manipulation">3.1.7. Data manipulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#index-operations">3.1.8. Index operations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#transaction-control">3.2. Transaction control</a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#cooperative-multitasking-environment">3.2.1. Cooperative multitasking environment</a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#example">3.2.1.1. Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#implicit-yields">3.2.2. Implicit yields</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#access-control">3.3. Access control</a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#passwords">3.3.1. Passwords</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#users-and-the-user-space">3.3.2. Users and the _user space</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#privileges-and-the-priv-space">3.3.3. Privileges and the _priv space</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#functions-and-the-func-space">3.3.4. Functions and the _func space</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#box-session-and-security">3.3.5. box.session and security</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#roles">3.3.6. Roles</a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#example-showing-a-role-within-a-role">3.3.6.1. Example showing a role within a role</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#triggers">3.4. Triggers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#connection-triggers">3.4.1. Connection triggers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#id3">3.4.1.1. Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#authentication-triggers">3.4.2. Authentication triggers</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#lua-module.box.space">3.4.3. Replace triggers</a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#id4">3.4.3.1. Example</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#another-example">3.4.3.2. Another example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#getting-a-list-of-triggers">3.4.4. Getting a list of triggers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#limitations">3.5. Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="box/index.html#vinyl-storage-engine">3.6. Vinyl storage engine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#differences-between-memtx-and-vinyl-storage-engines">3.6.1. Differences between memtx and vinyl storage engines</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#vinyl-features">3.6.2. Vinyl features</a></li>
<li class="toctree-l4"><a class="reference internal" href="box/index.html#under-the-hood">3.6.3. Under the hood</a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#inserting-the-first-200-000-keys">3.6.3.1. Inserting the first 200.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#inserting-the-next-300-000-keys">3.6.3.2. Inserting the next 300.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#inserting-the-next-200-000-keys">3.6.3.3. Inserting the next 200.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#inserting-the-last-300-000-keys">3.6.3.4. Inserting the last 300.000 keys</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/index.html#reading-million-keys">3.6.3.5. Reading million keys</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="app_server.html">4. Application server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#about-modules-rocks">4.1. About modules/rocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#installing-an-existing-module">4.2. Installing an existing module</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#creating-a-new-lua-module-locally">4.3. Creating a new Lua module locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#creating-a-new-c-c-module-locally">4.4. Creating a new C/C++ module locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#creating-a-mixed-lua-c-module-locally">4.5. Creating a mixed Lua/C module locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#tips-for-special-situations">4.6. Tips for special situations</a></li>
<li class="toctree-l3"><a class="reference internal" href="app_server.html#cookbook-recipes">4.7. Cookbook recipes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#hello-world-lua">4.7.1. hello_world.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#console-start-lua">4.7.2. console_start.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#fio-read-lua">4.7.3. fio_read.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#fio-write-lua">4.7.4. fio_write.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#ffi-printf-lua">4.7.5. ffi_printf.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#ffi-gettimeofday-lua">4.7.6. ffi_gettimeofday.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#ffi-zlib-lua">4.7.7. ffi_zlib.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#ffi-meta-lua">4.7.8. ffi_meta.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#print-arrays-lua">4.7.9. print_arrays.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#count-array-lua">4.7.10. count_array.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#count-array-with-nils-lua">4.7.11. count_array_with_nils.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#count-array-with-nulls-lua">4.7.12. count_array_with_nulls.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#count-map-lua">4.7.13. count_map.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#swap-lua">4.7.14. swap.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#uri-lua">4.7.15. uri.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#class-lua">4.7.16. class.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#garbage-lua">4.7.17. garbage.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#fiber-producer-and-consumer-lua">4.7.18. fiber_producer_and_consumer.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#socket-tcpconnect-lua">4.7.19. socket_tcpconnect.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#socket-tcp-echo-lua">4.7.20. socket_tcp_echo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#getaddrinfo-lua">4.7.21. getaddrinfo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#socket-udp-echo-lua">4.7.22. socket_udp_echo.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#http-get-lua">4.7.23. http_get.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#http-send-lua">4.7.24. http_send.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#http-server-lua">4.7.25. http_server.lua</a></li>
<li class="toctree-l4"><a class="reference internal" href="app_server.html#http-generate-html-lua">4.7.26. http_generate_html.lua</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5. Server administration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-tarantool-as-a-client">5.1. Using tarantool as a client</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#conventions-used-in-this-section">5.1.1. Conventions used in this section</a></li>
<li class="toctree-l4"><a class="reference internal" href="#options-when-starting-client-from-the-command-line">5.1.2. Options when starting client from the command line</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tokens-requests-and-special-key-combinations">5.1.3. Tokens, requests, and special key combinations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#requests">5.1.4. Requests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#utility-tarantoolctl">5.2. Utility tarantoolctl</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuration-for-tarantoolctl">5.2.1. Configuration for tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#commands-for-tarantoolctl">5.2.2. Commands for tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#typical-code-snippets-for-tarantoolctl">5.2.3. Typical code snippets for tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#a-detailed-example-for-tarantoolctl">5.2.4. A detailed example for tarantoolctl</a></li>
<li class="toctree-l4"><a class="reference internal" href="#an-example-for-tarantoolctl-connect">5.2.5. An example for tarantoolctl connect</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#administrative-ports">5.3. Administrative ports</a></li>
<li class="toctree-l3"><a class="reference internal" href="#administrative-requests">5.4. Administrative requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#server-introspection">5.5. Server introspection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#replication">5.6. Replication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#replication-architecture">5.6.1. Replication architecture</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-a-master">5.6.2. Setting up a master</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-a-replica">5.6.3. Setting up a replica</a></li>
<li class="toctree-l4"><a class="reference internal" href="#recovering-from-a-degraded-state">5.6.4. Recovering from a degraded state</a></li>
<li class="toctree-l4"><a class="reference internal" href="#quick-startup-of-a-new-simple-two-server-cluster">5.6.5. Quick startup of a new simple two-server cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="#monitoring-a-replica-s-actions">5.6.6. Monitoring a replica&#8217;s actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preventing-duplicate-actions">5.6.7. Preventing duplicate actions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#master-master-replication">5.6.8. Master-master replication</a></li>
<li class="toctree-l4"><a class="reference internal" href="#all-the-what-if-questions">5.6.9. All the &#8220;What If?&#8221; questions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hands-on-replication-tutorial">5.6.10. Hands-on replication tutorial</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#backups">5.7. Backups</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cold-backup">5.7.1. Cold backup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#continuous-remote-backup">5.7.2. Continuous remote backup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hot-backup">5.7.3. Hot backup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#updates-upgrades">5.8. Updates/upgrades</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#updating-tarantool-in-production">5.8.1. Updating Tarantool in production</a></li>
<li class="toctree-l4"><a class="reference internal" href="#upgrading-a-tarantool-database">5.8.2. Upgrading a Tarantool database</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#server-signal-handling">5.9. Server signal handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#process-title">5.10. Process title</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-specific-administration-notes">5.11. System-specific administration notes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#debian-gnu-linux-and-ubuntu">5.11.1. Debian GNU/Linux and Ubuntu</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fedora-rhel-centos">5.11.2. Fedora, RHEL, CentOS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#freebsd">5.11.3. FreeBSD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mac-os-x">5.11.4. Mac OS X</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#notes-for-systemd-users">5.12. Notes for systemd users</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#instance-management">5.12.1. Instance management</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#creating-instances">5.12.1.1. Creating instances</a></li>
<li class="toctree-l5"><a class="reference internal" href="#starting-instances">5.12.1.2. Starting instances</a></li>
<li class="toctree-l5"><a class="reference internal" href="#monitoring-instances">5.12.1.3. Monitoring instances</a></li>
<li class="toctree-l5"><a class="reference internal" href="#attaching-to-instances">5.12.1.4. Attaching to instances</a></li>
<li class="toctree-l5"><a class="reference internal" href="#checking-logs">5.12.1.5. Checking logs</a></li>
<li class="toctree-l5"><a class="reference internal" href="#stopping-instances">5.12.1.6. Stopping instances</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#daemon-supervision">5.12.2. Daemon supervision</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-the-service-file">5.12.3. Customizing the service file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#debugging">5.12.4. Debugging</a></li>
<li class="toctree-l4"><a class="reference internal" href="#precautions">5.12.5. Precautions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#limitations">5.12.6. Limitations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sysvinit-systemd-conversion">5.12.7. sysvinit -&gt; systemd conversion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="connectors/index.html">6. Connectors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#protocol">6.1. Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#packet-example">6.2. Packet example</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#setting-up-the-server-for-connector-examples">6.3. Setting up the server for connector examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#java">6.4. Java</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#go">6.5. Go</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#r">6.6. R</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#erlang">6.7. Erlang</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#perl">6.8. Perl</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#php">6.9. PHP</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#python">6.10. Python</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#node-js">6.11. node.js</a></li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#c">6.12. C</a><ul>
<li class="toctree-l4"><a class="reference internal" href="connectors/index.html#example-1">6.12.1. Example 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="connectors/index.html#example-2">6.12.2. Example 2</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="connectors/index.html#interpreting-function-return-values">6.13. Interpreting function return values</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="faq.html">7. FAQ</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference_lua/index.html">1. Built-in library reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/box.html">1.1. Module <cite>box</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="box/box_schema.html">1.1.1. Submodule <cite>box.schema</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="box/box_space.html">1.1.2. Submodule <cite>box.space</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/box_space.html#example-use-box-space-functions-to-read-space-tuples">1.1.2.1. Example: use box.space functions to read _space tuples</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/box_space.html#example-use-box-space-functions-to-organize-a-space-tuple">1.1.2.2. Example: use box.space functions to organize a _space tuple</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/box_index.html">1.1.3. Submodule <cite>box.index</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/box_index.html#example-showing-use-of-the-box-functions">1.1.3.1. Example showing use of the box functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/box_index.html#example-showing-a-user-defined-iterator">1.1.3.2. Example showing a user-defined iterator</a></li>
<li class="toctree-l5"><a class="reference internal" href="box/box_index.html#submodule-box-index-with-index-type-rtree-for-spatial-searches">1.1.3.3. Submodule <cite>box.index</cite> with index type = RTREE for spatial searches</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/box_session.html">1.1.4. Submodule <cite>box.session</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/box_session.html#example">1.1.4.1. Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/box_tuple.html">1.1.5. Submodule <cite>box.tuple</cite></a><ul>
<li class="toctree-l5"><a class="reference internal" href="box/box_tuple.html#example">1.1.5.1. Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="box/box_cfg.html">1.1.6. Submodule <cite>box.cfg</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="box/box_slab.html">1.1.7. Submodule <cite>box.slab</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="box/box_info.html">1.1.8. Submodule <cite>box.info</cite></a></li>
<li class="toctree-l4"><a class="reference internal" href="box/box_stat.html">1.1.9. Submodule <cite>box.stat</cite></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/clock.html">1.2. Module <cite>clock</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/console.html">1.3. Module <cite>console</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/crypto.html">1.4. Module <cite>crypto</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/crypto.html#incremental-methods-in-the-crypto-module">1.4.1. Incremental methods in the crypto module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/crypto.html#getting-the-same-results-from-digest-and-crypto-modules">1.4.2. Getting the same results from digest and crypto modules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/csv.html">1.5. Module <cite>csv</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/digest.html">1.6. Module <cite>digest</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/digest.html#incremental-methods-in-the-digest-module">1.6.1. Incremental methods in the digest module</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/digest.html#example">1.6.2. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/errno.html">1.7. Module <cite>errno</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/box_error.html">1.8. Submodule <cite>box.error</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fiber.html">1.9. Module <cite>fiber</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fiber.html#example-of-fiber-use">1.9.1. Example Of Fiber Use</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fiber_ipc.html">1.10. Submodule <cite>fiber-ipc</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fiber_ipc.html#example">1.10.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fiber_cond.html">1.11. Submodule <cite>fiber-cond</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fiber_cond.html#example">1.11.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fio.html">1.12. Module <cite>fio</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fio.html#common-pathname-manipulations">1.12.1. Common pathname manipulations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/fio.html#common-file-manipulations">1.12.2. Common file manipulations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/fun.html">1.13. Module <cite>fun</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/json.html">1.14. Module <cite>json</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/json.html#configuration-settings">1.14.1. Configuration settings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/log.html">1.15. Module <cite>log</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/log.html#example">1.15.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/msgpack.html">1.16. Module <cite>msgpack</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/msgpack.html#example">1.16.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/net_box.html">1.17. Module <cite>net.box</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/net_box.html#example">1.17.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/box_once.html">1.18. Function <cite>box.once</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/pickle.html">1.19. Module <cite>pickle</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/socket.html">1.20. Module <cite>socket</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/socket.html#examples">1.20.1. Examples</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-of-a-tcp-socket-over-the-internet">1.20.1.1. Use of a TCP socket over the Internet</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-of-a-udp-socket-on-localhost">1.20.1.2. Use of a UDP socket on localhost</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_lua/socket.html#use-tcp-server-to-accept-file-contents-sent-with-socat">1.20.1.3. Use tcp_server to accept file contents sent with socat</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/strict.html">1.21. Module <cite>strict</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/tap.html">1.22. Module <cite>tap</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/tap.html#example">1.22.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/tarantool.html">1.23. Module <cite>tarantool</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/uuid.html">1.24. Module <cite>uuid</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/uuid.html#example">1.24.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/xlog.html">1.25. Module <cite>xlog</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/yaml.html">1.26. Module <cite>yaml</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_lua/yaml.html#example">1.26.1. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/other.html">1.27. Miscellaneous</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/errcodes.html">1.28. Database error codes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_lua/errcodes.html#handling-errors">1.29. Handling errors</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/reference_rock/index.html">2. Rocks reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/dbms.html">2.1. SQL DBMS Modules</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/dbms.html#mysql-example">2.1.1. MySQL Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#installation">2.1.1.1. Installation</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#with-luarocks">2.1.1.1.1. With LuaRocks</a></li>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#with-github">2.1.1.1.2. With GitHub</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#connecting">2.1.1.2. Connecting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#how-to-ping">2.1.1.3. How to ping</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#executing-a-statement">2.1.1.4. Executing a statement</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#closing-connection">2.1.1.5. Closing connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#example">2.1.1.6. Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/dbms.html#postgresql-example">2.1.2. PostgreSQL Example</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id1">2.1.2.1. Installation</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#id2">2.1.2.1.1. With LuaRocks</a></li>
<li class="toctree-l6"><a class="reference internal" href="../reference/reference_rock/dbms.html#id3">2.1.2.1.2. With GitHub</a></li>
</ul>
</li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id4">2.1.2.2. Connecting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id5">2.1.2.3. How to ping</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id6">2.1.2.4. Executing a statement</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id7">2.1.2.5. Closing connection</a></li>
<li class="toctree-l5"><a class="reference internal" href="../reference/reference_rock/dbms.html#id8">2.1.2.6. Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/expirationd.html">2.2. Module <cite>expirationd</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/shard.html">2.3. Module <cite>shard</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-init-syntax-for-one-shard">2.3.1. Example: shard.init syntax for one shard</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-init-syntax-for-three-shards">2.3.2. Example: shard.init syntax for three shards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-minimal-configuration">2.3.3. Example: Shard, Minimal Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/shard.html#example-shard-scaling-out">2.3.4. Example: Shard, Scaling Out</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/reference_rock/tdb.html">2.4. Module <cite>tdb</cite></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/tdb.html#debugger-commands">2.4.1. Debugger Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/reference_rock/tdb.html#example-session">2.4.2. Example Session</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/configuration/index.html">3. Configuration reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#command-options">3.1. Command options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#uri">3.2. URI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#initialization-file">3.3. Initialization file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/configuration/index.html#configuration-parameters">3.4. Configuration parameters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#basic-parameters">3.4.1. Basic parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#configuring-the-storage">3.4.2. Configuring the storage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#snapshot-daemon">3.4.3. Snapshot daemon</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#binary-logging-and-snapshots">3.4.4. Binary logging and snapshots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#replication">3.4.5. Replication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#networking">3.4.6. Networking</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/configuration/index.html#logging">3.4.7. Logging</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev_guide/index.html">Contributor&#8217;s Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev_guide/reference_capi/index.html">1. C API reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/box.html">1.1. Module <cite>box</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/clock.html">1.2. Module <cite>clock</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/coio.html">1.3. Module <cite>coio</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/error.html">1.4. Module <cite>error</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/fiber.html">1.5. Module <cite>fiber</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/box_index.html">1.6. Module <cite>index</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/latch.html">1.7. Module <cite>latch</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/utils.html">1.8. Module <cite>lua/utils</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/say.html">1.9. Module <cite>say</cite> (logging)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/schema.html">1.10. Module <cite>schema</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/trivia.html">1.11. Module <cite>trivia/config</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/tuple.html">1.12. Module <cite>tuple</cite></a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/reference_capi/txn.html">1.13. Module <cite>txn</cite></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev_guide/internals_index.html">2. Internals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/internals_index.html#tarantool-s-binary-protocol">2.1. Tarantool&#8217;s binary protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#notation-in-diagrams">2.1.1. Notation in diagrams</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#greeting-packet">2.1.2. Greeting packet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#unified-packet-structure">2.1.3. Unified packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#authentication">2.1.4. Authentication</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#requests">2.1.5. Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#response-packet-structure">2.1.6. Response packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#replication-packet-structure">2.1.7. Replication packet structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/internals_index.html#xlog-snap">2.1.8. XLOG / SNAP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/internals_index.html#data-persistence-and-the-wal-file-format">2.2. Data persistence and the WAL file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/internals_index.html#the-snapshot-file-format">2.3. The snapshot file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/internals_index.html#the-recovery-process">2.4. The recovery process</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/internals_index.html#server-startup-with-replication">2.5. Server startup with replication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev_guide/build_contribute_index.html">3. Build and contribute</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/building_from_source.html">3.1. Building from source</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/building_documentation.html">3.2. Building documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/release_management.html">3.3. Release management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/release_management.html#how-to-make-a-minor-release">3.3.1. How to make a minor release</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev_guide/guidelines_index.html">4. Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/developer_guidelines.html">4.1. Developer guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/developer_guidelines.html#how-to-work-on-a-bug">4.1.1. How to work on a bug</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/documentation_guidelines.html">4.2. Documentation guidelines</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#markup-issues">4.2.1. Markup issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#wrapping-text">4.2.1.1. Wrapping text</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#formatting-code-snippets">4.2.1.2. Formatting code snippets</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#using-separated-links">4.2.1.3. Using separated links</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#creating-labels-for-local-links">4.2.1.4. Creating labels for local links</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#making-comments">4.2.1.5. Making comments</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#language-and-style-issues">4.2.2. Language and style issues</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#us-vs-british-spelling">4.2.2.1. US vs British spelling</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#examples-and-templates">4.2.3. Examples and templates</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#module-and-function">4.2.3.1. Module and function</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/documentation_guidelines.html#module-class-and-method">4.2.3.2. Module, class and method</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/c_style_guide.html">4.3. C Style Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/c_style_guide.html#general-guidelines">4.3.1. General guidelines</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#commenting-style">4.3.1.1. Commenting style</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#header-files">4.3.1.2. Header files</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#allocating-memory">4.3.1.3. Allocating memory</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#other">4.3.1.4. Other</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/c_style_guide.html#linux-kernel-coding-style">4.3.2. Linux kernel coding style</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-1-indentation">4.3.2.1. Chapter 1: Indentation</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-2-breaking-long-lines-and-strings">4.3.2.2. Chapter 2: Breaking long lines and strings</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-3-placing-braces-and-spaces">4.3.2.3. Chapter 3: Placing Braces and Spaces</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-3-1-spaces">4.3.2.4. Chapter 3.1:  Spaces</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-4-naming">4.3.2.5. Chapter 4: Naming</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-5-typedefs">4.3.2.6. Chapter 5: Typedefs</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-6-functions">4.3.2.7. Chapter 6: Functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-7-centralized-exiting-of-functions">4.3.2.8. Chapter 7: Centralized exiting of functions</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-8-commenting">4.3.2.9. Chapter 8: Commenting</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-9-you-ve-made-a-mess-of-it">4.3.2.10. Chapter 9: You&#8217;ve made a mess of it</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-10-kconfig-configuration-files">4.3.2.11. Chapter 10: Kconfig configuration files</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-11-data-structures">4.3.2.12. Chapter 11: Data structures</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-12-macros-enums-and-rtl">4.3.2.13. Chapter 12: Macros, Enums and RTL</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-13-printing-kernel-messages">4.3.2.14. Chapter 13: Printing kernel messages</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-14-allocating-memory">4.3.2.15. Chapter 14: Allocating memory</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-15-the-inline-disease">4.3.2.16. Chapter 15: The inline disease</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-16-function-return-values-and-names">4.3.2.17. Chapter 16: Function return values and names</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-17-don-t-re-invent-the-kernel-macros">4.3.2.18. Chapter 17:  Don&#8217;t re-invent the kernel macros</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#chapter-18-editor-modelines-and-other-cruft">4.3.2.19. Chapter 18:  Editor modelines and other cruft</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/c_style_guide.html#appendix-i-references">4.3.2.20. Appendix I: References</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../dev_guide/python_style_guide.html">4.4. Python Style Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#introduction">4.4.1. Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#a-foolish-consistency-is-the-hobgoblin-of-little-minds">4.4.2. A Foolish Consistency is the Hobgoblin of Little Minds</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#code-lay-out">4.4.3. Code lay-out</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#indentation">4.4.3.1. Indentation</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#tabs-or-spaces">4.4.3.2. Tabs or Spaces?</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#maximum-line-length">4.4.3.3. Maximum Line Length</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#blank-lines">4.4.3.4. Blank Lines</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#encodings-pep-263">4.4.3.5. Encodings (PEP 263)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#imports">4.4.3.6. Imports</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#whitespace-in-expressions-and-statements">4.4.4. Whitespace in Expressions and Statements</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#pet-peeves">4.4.4.1. Pet Peeves</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#other-recommendations">4.4.4.2. Other Recommendations</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#comments">4.4.5. Comments</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#block-comments">4.4.5.1. Block Comments</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#inline-comments">4.4.5.2. Inline Comments</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#documentation-strings">4.4.5.3. Documentation Strings</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#version-bookkeeping">4.4.6. Version Bookkeeping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#naming-conventions">4.4.7. Naming Conventions</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#descriptive-naming-styles">4.4.7.1. Descriptive: Naming Styles</a></li>
<li class="toctree-l5"><a class="reference internal" href="../dev_guide/python_style_guide.html#prescriptive-naming-conventions">4.4.7.2. Prescriptive: Naming Conventions</a><ul>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#names-to-avoid">4.4.7.2.1. Names to Avoid</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#package-and-module-names">4.4.7.2.2. Package and Module Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#class-names">4.4.7.2.3. Class Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#exception-names">4.4.7.2.4. Exception Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#global-variable-names">4.4.7.2.5. Global Variable Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#function-names">4.4.7.2.6. Function Names</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#function-and-method-arguments">4.4.7.2.7. Function and method arguments</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#method-names-and-instance-variables">4.4.7.2.8. Method Names and Instance Variables</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#constants">4.4.7.2.9. Constants</a></li>
<li class="toctree-l6"><a class="reference internal" href="../dev_guide/python_style_guide.html#designing-for-inheritance">4.4.7.2.10. Designing for inheritance</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#references">4.4.8. References</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dev_guide/python_style_guide.html#copyright">4.4.9. Copyright</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
        <div class="b-cols_content_right">
          <div class="b-cols_content_right-slot">
  <div class="b-page_header">
    <ul class="b-path-list">
      <li class="b-path-list-item">
        <a href="../index.html"
           class="b-path-list-item-url">
          Documentation
        </a>
      </li>
      
        <li class="b-path-list-item">
          <a href="index.html"
             class="b-path-list-item-url b-ellipsis">
            User&#8217;s Guide
          </a>
        </li>
      
      
      <li class="b-path-list-item">
        <div title="5. Server administration" class="b-path_current b-ellipsis">
          5. Server administration
        </div>
      </li>
      
    </ul>
  </div>

  <article class="b-article">
    
    <div class="section" id="server-administration">
<span id="server-admin"></span><h1>5. Server administration<a class="headerlink" href="#server-administration" title="Ссылка на этот заголовок">¶</a></h1>
<p>Typical server administration tasks include starting and stopping the server,
reloading configuration, taking snapshots, log rotation.</p>
<div class="section" id="using-tarantool-as-a-client">
<span id="administration-using-tarantool-as-a-client"></span><h2>5.1. Using tarantool as a client<a class="headerlink" href="#using-tarantool-as-a-client" title="Ссылка на этот заголовок">¶</a></h2>
<p>If <strong class="program">tarantool</strong> is started without an <a class="reference internal" href="../reference/configuration/index.html#index-init-label"><span class="std std-ref">initialization file</span></a>,
or if the initialization file contains <a class="reference internal" href="../reference/reference_lua/console.html#console-start"><span class="std std-ref">console.start()</span></a>, then
<strong class="program">tarantool</strong> enters interactive mode. There will be a prompt (&#8220;<code class="docutils literal"><span class="pre">tarantool&gt;</span></code>&#8221;)
and it will be possible to enter requests. When used this way, <strong class="program">tarantool</strong>
can be a client for a remote server.</p>
<p>This section shows all legal syntax for the <strong class="program">tarantool</strong> program, with
short notes and examples. Other client programs may have similar options and
request syntaxes. Some of the information in this section is duplicated in the
chapter <a class="reference internal" href="../reference/configuration/index.html#index-book-cfg"><span class="std std-ref">Configuration reference</span></a>.</p>
<div class="section" id="conventions-used-in-this-section">
<h3>5.1.1. Conventions used in this section<a class="headerlink" href="#conventions-used-in-this-section" title="Ссылка на этот заголовок">¶</a></h3>
<p>Tokens are character sequences which are treated as syntactic units within
requests. Square brackets [ and ] enclose optional syntax. Three dots in a
row ... mean the preceding tokens may be repeated. A vertical bar | means
the preceding and following tokens are mutually exclusive alternatives.</p>
</div>
<div class="section" id="options-when-starting-client-from-the-command-line">
<h3>5.1.2. Options when starting client from the command line<a class="headerlink" href="#options-when-starting-client-from-the-command-line" title="Ссылка на этот заголовок">¶</a></h3>
<p>General form:</p>
<pre class="highlight literal-block">
$ <strong>tarantool</strong>
OR
$ <strong>tarantool</strong> <em>options</em>
OR
$ <strong>tarantool</strong> <em>lua-initialization-file</em> <strong>[</strong> <em>arguments</em> <strong>]</strong>
</pre>
<p>Here <em>lua-initialization-file</em> can be any script containing code for initializing.
Effect: The code in the file is executed during startup. Example: <code class="samp docutils literal"><span class="pre">init.lua</span></code>.
<br /> Notes: If a script is used, there will be no prompt. The script should contain
configuration information including <code class="samp docutils literal"><span class="pre">box.cfg</span><em><span class="pre">...listen=...</span></em></code> or
<code class="samp docutils literal"><span class="pre">box.listen(...)</span></code> so that a separate program can connect to the server via
one of the ports.</p>
<p><em>Option</em> is one of the following (in alphabetical order by the long form of the
option):</p>
<dl class="option">
<dt id="cmdoption-tarantool-?">
<span id="cmdoption-tarantool-h"></span><span id="cmdoption-tarantool--help"></span><code class="descname">-?</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">-h</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--help</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-tarantool-?" title="Ссылка на это определение">¶</a></dt>
<dd><p>Client displays a help message including a list of options.
Example: <code class="samp docutils literal"><span class="pre">tarantool</span> <span class="pre">--help</span></code>
The program stops after displaying the help.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantool-V">
<span id="cmdoption-tarantool--version"></span><code class="descname">-V</code><code class="descclassname"></code><code class="descclassname">, </code><code class="descname">--version</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-tarantool-V" title="Ссылка на это определение">¶</a></dt>
<dd><p>Client displays version information.
Example: <code class="samp docutils literal"><span class="pre">tarantool</span> <span class="pre">--version</span></code>.
The program stops after displaying the version.</p>
</dd></dl>

</div>
<div class="section" id="tokens-requests-and-special-key-combinations">
<h3>5.1.3. Tokens, requests, and special key combinations<a class="headerlink" href="#tokens-requests-and-special-key-combinations" title="Ссылка на этот заголовок">¶</a></h3>
<p>Procedure identifiers are: Any sequence of letters, digits, or underscores
which is legal according to the rules for Lua identifiers. Procedure
identifiers are also called function names. <br />
Note: function names are case sensitive so <code class="docutils literal"><span class="pre">insert</span></code> and <code class="docutils literal"><span class="pre">Insert</span></code> are not the
same thing.</p>
<p>String literals are: Any sequence of zero or more characters enclosed in
single quotes. Double quotes are legal but single quotes are preferred.
Enclosing in double square brackets is good for multi-line strings as
described in <a class="reference external" href="http://www.lua.org/pil/2.4.html">Lua documentation</a>. <br />
Examples: &#8216;Hello, world&#8217;, &#8216;A&#8217;, [[A\B!]].</p>
<p>Numeric literals are: Any sequence of one or more digits, not enclosed in
quotes, optionally preceded by - (minus sign).
Large or floating-point numeric
literals may include decimal points, exponential notation, or suffixes.|br|
Examples: 500, -500, 5e2, 500.1, 5LL, 5ULL.</p>
<p>Single-byte tokens are: , or ( or ) or arithmetic operators. <br />
Examples: * , ( ).</p>
<p>Tokens must be separated from each other by one or more spaces, except that
spaces are not necessary around single-byte tokens or string literals.</p>
</div>
<div class="section" id="requests">
<span id="administration-setting-delimiter"></span><h3>5.1.4. Requests<a class="headerlink" href="#requests" title="Ссылка на этот заголовок">¶</a></h3>
<p>Generally requests are entered following the prompt in interactive mode while
<strong class="program">tarantool</strong> is running. (A prompt will be the word &#8216;tarantool&#8217; and a
greater-than sign, for example <code class="samp docutils literal"><span class="pre">tarantool&gt;</span></code>). The end-of-request marker is
by default a newline (line feed).</p>
<p>For multi-line requests, it is possible to change the end-of-request marker.
Syntax: <code class="samp docutils literal"><span class="pre">console</span> <span class="pre">=</span> <span class="pre">require('console');</span> <span class="pre">console.delimiter(</span><em><span class="pre">string-literal</span></em><span class="pre">)</span></code>.
The string-literal must be a value in single quotes. Effect: string becomes
end-of-request delimiter, so newline alone is not treated as end of request.
To go back to normal mode: <code class="samp docutils literal"><span class="pre">console.delimiter('')</span><em><span class="pre">string-literal</span></em></code>.
Delimiters are usually not necessary because Tarantool can tell when a
multi-line request has not ended (for example, if it sees that a function
declaration does not have an <code class="samp docutils literal"><span class="pre">end</span></code> keyword). Example:</p>
<div class="highlight-lua_tarantool"><div class="highlight"><pre><span></span><span class="n">console</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">console&#39;</span><span class="p">);</span> <span class="n">console</span><span class="p">.</span><span class="n">delimiter</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">!&#39;</span><span class="p">)</span>
<span class="k">function</span> <span class="nf">f</span> <span class="p">()</span>
  <span class="n">statement_1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">a&#39;</span>
  <span class="n">statement_2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">b&#39;</span>
<span class="k">end</span><span class="p">!</span>
<span class="n">console</span><span class="p">.</span><span class="n">delimiter</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">)!</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../dev_guide/internals_index.html#box-protocol-iproto-protocol"><span class="std std-ref">here</span></a> a condensed Backus-Naur Form
[BNF] description of the suggested form of client requests.</p>
<p>In <em>interactive</em> mode, one types requests and gets results. Typically the
requests are typed in by the user following prompts. Here is an example of
an interactive-mode Tarantool client session:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantool
<span class="go">[ tarantool will display an introductory message</span>
<span class="go">  including version number here ]</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">[ tarantool will display configuration information here ]</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="go">[ tarantool may display an in-progress message here ]</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">hash&#39;</span><span class="p">,</span> <span class="n">parts</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">unsigned&#39;</span><span class="p">}})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">My first tuple&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;My</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">tuple&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;My</span><span class="nv"> </span><span class="s">first</span><span class="nv"> </span><span class="s">tuple&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">drop</span><span class="p">()</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">2014-04-30 10:28:00.886 [20436] main/101/spawner I&gt; Exiting: master shutdown</span>
<span class="go">$</span>
</pre></div>
</div>
<p>Explanatory notes about what Tarantool displayed in the above example:</p>
<ul class="simple">
<li>Many requests return typed objects. In the case of <code class="samp docutils literal"><span class="pre">box.cfg</span><em><span class="pre">listen=3301</span></em></code>,
this result is displayed on the screen. If the request had assigned the result
to a variable, for example <code class="samp docutils literal"><span class="pre">c</span> <span class="pre">=</span> <span class="pre">box.cfg</span><em><span class="pre">listen=3301</span></em></code>, then the result
would not have been displayed on the screen.</li>
<li>A display of an object always begins with &#8220;<code class="docutils literal"><span class="pre">---</span></code>&#8221; and ends with &#8220;<code class="docutils literal"><span class="pre">...</span></code>&#8221;.</li>
<li>The insert request returns an object of type = tuple, so the object display
line begins with a single dash (&#8216;<code class="docutils literal"><span class="pre">-</span></code>&#8216;). However, the select request returns
an object of type = table of tuples, so the object display line begins with
two dashes (&#8216;<code class="docutils literal"><span class="pre">-</span> <span class="pre">-</span></code>&#8216;).</li>
</ul>
</div>
</div>
<div class="section" id="utility-tarantoolctl">
<span id="administration-tarantoolctl"></span><h2>5.2. Utility tarantoolctl<a class="headerlink" href="#utility-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h2>
<p>With <strong class="program">tarantoolctl</strong>, you can say: &#8220;start an instance of the Tarantool
server which runs a single user-written Lua program, allocating disk resources
specifically for that program, via a standardized deployment method.&#8221;</p>
<p>If Tarantool was installed with Debian or
Red Hat installation packages, the script is
in <code class="file docutils literal"><span class="pre">/usr/bin/tarantoolctl</span></code> or <code class="file docutils literal"><span class="pre">/usr/local/bin/tarantoolctl</span></code>.
The script handles such things as:
starting, stopping, rotating logs, logging in to the application&#8217;s console,
and checking status.</p>
<p>Also, you can use <strong class="program">tarantoolctl</strong>
<a class="reference internal" href="#administration-tarantoolctl-connect"><span class="std std-ref">as a client</span></a> to connect to another
instance of Tarantool server and pass requests.</p>
<div class="section" id="configuration-for-tarantoolctl">
<h3>5.2.1. Configuration for tarantoolctl<a class="headerlink" href="#configuration-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>The <strong class="program">tarantoolctl</strong> script will look for a configuration file
in the current directory (<code class="file docutils literal"><span class="pre">$PWD/.tarantoolctl</span></code>).
If that fails, it looks in the current user&#8217;s home directory
(<code class="file docutils literal"><span class="pre">$HOME/.config/tarantool/tarantool</span></code>).
If that fails, it looks in the SYSCONFDIR directory (usually
<code class="file docutils literal"><span class="pre">/etc/sysconfig/tarantool</span></code>, but it may be different on some platforms).
Most of the settings are similar to the settings used by <code class="samp docutils literal"><span class="pre">box.cfg</span><em><span class="pre">...</span></em></code>;
however, <strong class="program">tarantoolctl</strong> adjusts some of them by adding an application
name. A copy of <code class="file docutils literal"><span class="pre">usr/local/etc/default/tarantool</span></code>, with defaults for all
settings, would look like this:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">default_cfg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">pid_file</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/run/tarantool&quot;</span><span class="p">,</span>
    <span class="n">wal_dir</span>    <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">snap_dir</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">vinyl_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/lib/tarantool&quot;</span><span class="p">,</span>
    <span class="n">logger</span>     <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/var/log/tarantool&quot;</span><span class="p">,</span>
    <span class="n">username</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="s">tarantool&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">instance_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/etc/tarantool/instances.enabled&quot;</span>
</pre></div>
</div>
<p>The settings in the above script are:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">pid_file</span></code></dt>
<dd>The directory for the pid file and control-socket file. The
script will add &#8220;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&#8221; to the directory name.</dd>
<dt><code class="docutils literal"><span class="pre">wal_dir</span></code></dt>
<dd>The directory for the write-ahead <code class="file docutils literal"><span class="pre">*.xlog</span></code> files. The
script will add &#8220;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&#8221; to the directory-name.</dd>
<dt><code class="docutils literal"><span class="pre">snap_dir</span></code></dt>
<dd>The directory for the snapshot <code class="file docutils literal"><span class="pre">*.snap</span></code> files. The script
will add &#8220;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em></code>&#8221; to the directory-name.</dd>
<dt><code class="docutils literal"><span class="pre">vinyl_dir</span></code></dt>
<dd>The directory for the vinyl-storage-engine files. The script
will add &#8220;<code class="samp docutils literal"><span class="pre">/vinyl/</span><em><span class="pre">instance-name</span></em></code>&#8221; to the directory-name.</dd>
<dt><code class="docutils literal"><span class="pre">logger</span></code></dt>
<dd>The place where the application log will go. The script will
add &#8220;<code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">instance-name</span></em><span class="pre">.log</span></code>&#8221; to the name.</dd>
<dt><code class="docutils literal"><span class="pre">username</span></code></dt>
<dd>The user that runs the Tarantool server. This is the operating-system
user name rather than the Tarantool-client user name.</dd>
<dt><code class="docutils literal"><span class="pre">instance_dir</span></code></dt>
<dd>The directory where all applications for this host are stored. The user
who writes an application for <strong class="program">tarantoolctl</strong> must put the
application&#8217;s source code in this directory, or a symbolic link. For
examples in this section the application name <code class="docutils literal"><span class="pre">my_app</span></code> will be used, and
its source will have to be in <code class="samp docutils literal"><em><span class="pre">instance_dir</span></em><span class="pre">/my_app.lua</span></code>.</dd>
</dl>
</div>
<div class="section" id="commands-for-tarantoolctl">
<h3>5.2.2. Commands for tarantoolctl<a class="headerlink" href="#commands-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>The command format is <code class="samp docutils literal"><span class="pre">tarantoolctl</span> <em><span class="pre">operation</span></em> <em><span class="pre">application_name</span></em></code>, where
operation is one of: start, stop, enter, logrotate, status, eval. Thus ...</p>
<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-start">
<code class="descname">start</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-start" title="Ссылка на это определение">¶</a></dt>
<dd><p>Start application <em>&lt;application&gt;</em></p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-stop">
<code class="descname">stop</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-stop" title="Ссылка на это определение">¶</a></dt>
<dd><p>Stop application</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-enter">
<code class="descname">enter</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-enter" title="Ссылка на это определение">¶</a></dt>
<dd><p>Show application&#8217;s admin console</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-logrotate">
<code class="descname">logrotate</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-logrotate" title="Ссылка на это определение">¶</a></dt>
<dd><p>Rotate application&#8217;s log files (make new, remove old)</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-status">
<code class="descname">status</code><code class="descclassname"> &lt;application&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-status" title="Ссылка на это определение">¶</a></dt>
<dd><p>Check application&#8217;s status</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-eval">
<code class="descname">eval</code><code class="descclassname"> &lt;application&gt; &lt;scriptname&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-eval" title="Ссылка на это определение">¶</a></dt>
<dd><p>Execute code from <em>&lt;scriptname&gt;</em> on an instance of application</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-tarantoolctl-arg-connect">
<code class="descname">connect</code><code class="descclassname"> &lt;URI&gt;</code><a class="headerlink" href="#cmdoption-tarantoolctl-arg-connect" title="Ссылка на это определение">¶</a></dt>
<dd><p>Connect to a Tarantool server running at the specified <a class="reference internal" href="../reference/configuration/index.html#index-uri"><span class="std std-ref">URI</span></a></p>
</dd></dl>

</div>
<div class="section" id="typical-code-snippets-for-tarantoolctl">
<h3>5.2.3. Typical code snippets for tarantoolctl<a class="headerlink" href="#typical-code-snippets-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>A user can check whether <code class="docutils literal"><span class="pre">my_app</span></code> is running with these lines:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="k">if</span> tarantoolctl status my_app<span class="p">;</span> <span class="k">then</span>
...
<span class="k">fi</span>
</pre></div>
</div>
<p>A user can initiate, for boot time, an <code class="file docutils literal"><span class="pre">init.d</span></code> set of instructions:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">(</span>each file mentioned in the instance_dir directory<span class="o">)</span>:
    tarantoolctl start <span class="sb">`</span>basename $ file .lua<span class="sb">`</span>
</pre></div>
</div>
<p>A user can set up a further configuration file for log rotation, like this:</p>
<pre class="highlight literal-block">
/path/to/tarantool/*.log {
    daily
    size 512k
    missingok
    rotate 10
    compress
    delaycompress
    create 0640 tarantool adm
    postrotate
        /path/to/tarantoolctl logrotate <cite>basename $ 1 .log</cite>
    endscript
}
</pre>
</div>
<div class="section" id="a-detailed-example-for-tarantoolctl">
<h3>5.2.4. A detailed example for tarantoolctl<a class="headerlink" href="#a-detailed-example-for-tarantoolctl" title="Ссылка на этот заголовок">¶</a></h3>
<p>The example&#8217;s objective is to make a temporary directory where
<strong class="program">tarantoolctl</strong> can start a long-running application and monitor it.</p>
<p>The assumptions are: the root password is known, the computer is only being used
for tests, the Tarantool server is ready to run but is not currently running,
tarantoolctl is installed along the user&#8217;s path,
and there currently is no directory named <code class="file docutils literal"><span class="pre">tarantool_test</span></code>.</p>
<p>Create a directory named <code class="file docutils literal"><span class="pre">/tarantool_test</span></code>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo mkdir /tarantool_test
</pre></div>
</div>
<p>Edit <code class="file docutils literal"><span class="pre">/usr/local/etc/default/tarantool</span></code>. It might be necessary to
say <code class="samp docutils literal"><span class="pre">sudo</span> <span class="pre">mkdir</span> <span class="pre">/usr/local/etc/default</span></code> first. Let the new file contents
be:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">default_cfg</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">pid_file</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test/my_app.pid&quot;</span><span class="p">,</span>
    <span class="n">wal_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span><span class="p">,</span>
    <span class="n">snap_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span><span class="p">,</span>
    <span class="n">vinyl_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span><span class="p">,</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test/log&quot;</span><span class="p">,</span>
    <span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">tarantool&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">instance_dir</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">/tarantool_test&quot;</span>
</pre></div>
</div>
<p>Make the <code class="docutils literal"><span class="pre">my_app</span></code> application file, that is, <code class="file docutils literal"><span class="pre">/tarantool_test/my_app.lua</span></code>.
Let the file contents be:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">passwd</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">Gx5!&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">guest&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">read,write,execute&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">universe&#39;</span><span class="p">)</span>
<span class="n">fiber</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">fiber&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,{})</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="mi">0</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">do</span>
    <span class="n">fiber</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">insert &#39;</span> <span class="o">..</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">my_app tuple&#39;</span><span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Tell <strong class="program">tarantoolctl</strong> to start the application ...</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /tarantool_test
<span class="gp">$</span> sudo tarantoolctl start my_app
</pre></div>
</div>
<p>... expect to see messages indicating that the instance has started. Then ...</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ls -l /tarantool_test/my_app
</pre></div>
</div>
<p>... expect to see the <code class="file docutils literal"><span class="pre">.snap</span></code> file and the <code class="file docutils literal"><span class="pre">.xlog</span></code> file. Then ...</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo less /tarantool_test/log/my_app.log
</pre></div>
</div>
<p>... expect to see the contents of <code class="docutils literal"><span class="pre">my_app</span></code>&#8216;s log, including error messages, if
any. Then ...</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /tarantool_test
<span class="gp">$</span> <span class="c1"># assume that &#39;tarantool&#39; invokes the tarantool server</span>
<span class="gp">$</span> sudo tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{}</span>
<span class="gp">tarantool&gt; </span><span class="n">console</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">console&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">console</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">localhost:3301&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>... expect to see several tuples that <code class="docutils literal"><span class="pre">my_app</span></code> has created.</p>
<p>Stop. The only clean way to stop <code class="docutils literal"><span class="pre">my_app</span></code> is with <strong class="program">tarantoolctl</strong>, thus:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> sudo tarantoolctl stop my_app
</pre></div>
</div>
<p>Clean up. Restore the original contents of <code class="file docutils literal"><span class="pre">/usr/local/etc/default/tarantool</span></code>,
and ...</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> /
<span class="gp">$</span> sudo rm -R tarantool_test
</pre></div>
</div>
</div>
<div class="section" id="an-example-for-tarantoolctl-connect">
<span id="administration-tarantoolctl-connect"></span><h3>5.2.5. An example for tarantoolctl connect<a class="headerlink" href="#an-example-for-tarantoolctl-connect" title="Ссылка на этот заголовок">¶</a></h3>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl connect username:password@127.0.0.1:3306
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">There are alternatives to <strong class="program">tarantoolctl connect</strong> &#8211; you can use
the <a class="reference internal" href="../reference/reference_lua/console.html#console-module"><span class="std std-ref">console module</span></a> or the
<a class="reference internal" href="../reference/reference_lua/net_box.html#net-box-module"><span class="std std-ref">net.box module</span></a> from a Tarantool server.
Also, you can write your client programs with any of the
Connectors. However, most of the examples in this manual illustrate
usage with either <strong class="program">tarantoolctl connect</strong> or with
<a class="reference internal" href="#administration-using-tarantool-as-a-client"><span class="std std-ref">using the Tarantool server as a client</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="administrative-ports">
<span id="administration-admin-ports"></span><h2>5.3. Administrative ports<a class="headerlink" href="#administrative-ports" title="Ссылка на этот заголовок">¶</a></h2>
<p>&#8220;Admin port&#8221;, &#8220;admin console&#8221;, and &#8220;text protocol&#8221; all
refer to the same thing: a connection which is set up
with <a class="reference internal" href="../reference/reference_lua/console.html#console-listen"><span class="std std-ref">console.listen(...)</span></a> for entry of requests by
administrators.</p>
<p>&#8220;Binary port&#8221;, &#8220;binary protocol&#8221;, and &#8220;primary port&#8221;
all refer to a different thing: a connection which is set up
with <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-listen"><span class="std std-ref">box.cfg{listen=...}</span></a> for entry of requests by
anyone.</p>
<p>Ordinary connections to the Tarantool server should go via a binary port.
But admin ports are useful for special cases involving security.</p>
<p>When you connect to an admin port:</p>
<ul class="simple">
<li>No password is necessary</li>
<li>The user is automatically &#8216;admin&#8217;, a user with many privileges.</li>
</ul>
<p>Therefore you must set up admin ports very cautiously.
If it is a TCP port, it should only be opened for a specific IP.
Ideally it should not be a TCP port at all, it should be a Unix domain socket,
so that access to the server machine is required.
Thus a typical setup for an admin port is:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">console.listen(&#39;/var/lib/tarantool/socket_name.sock&#39;)</span>
</pre></div>
</div>
<p>and a typical connection <a class="reference internal" href="../reference/configuration/index.html#index-uri"><span class="std std-ref">URI</span></a> is:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>admin:any_string@/var/lib/tarantool/socket_name.sock
</pre></div>
</div>
<p>if the listener has the privilege to write on <code class="file docutils literal"><span class="pre">/var/lib/tarantool</span></code>
and the connector has the privilege to read on <code class="file docutils literal"><span class="pre">/var/lib/tarantool</span></code>.
Alternatively both setup and connection can be done with
<a class="reference internal" href="#administration-tarantoolctl"><span class="std std-ref">tarantoolctl</span></a>.</p>
<p>If no administrator password exists which could be given out to users,
and admin ports are restricted or are sockets,
then requests which require &#8216;admin&#8217; privileges can only occur locally,
and are subject to Unix security and monitoring.</p>
<p>For additional security, some requests are illegal.
For example, <a class="reference internal" href="../reference/reference_lua/net_box.html#net-box-eval"><span class="std std-ref">&#8220;conn:eval&#8221;</span></a>  will result in the error message
&#8220;- error: console does not support this request type&#8221;
because <code class="docutils literal"><span class="pre">conn:eval</span></code> requires the binary protocol.</p>
<p>If security via admin ports is not necessary, it is still possible
to be an admin user by
<a class="reference internal" href="#administration-using-tarantool-as-a-client"><span class="std std-ref">using the tarantool server as a client</span></a>,
or by connecting to a binary port with a valid password.</p>
<p>To find out whether a TCP port is an admin port, use <strong class="program">telnet</strong>.
For example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> telnet <span class="m">0</span> 3303
<span class="go">Trying 0.0.0.0...</span>
<span class="go">Connected to 0.</span>
<span class="go">Escape character is &#39;^]&#39;.</span>
<span class="go">Tarantool 1.7.2-70-gbc479ad (Lua console)</span>
<span class="go">type &#39;help&#39; for interactive help</span>
</pre></div>
</div>
<p>In this example the response does not include the word &#8220;binary&#8221;
and does include the words &#8220;Lua console&#8221;. Therefore it is
clear that this is a successful connection to an admin
port, and admin requests can now be entered on this terminal.</p>
</div>
<div class="section" id="administrative-requests">
<h2>5.4. Administrative requests<a class="headerlink" href="#administrative-requests" title="Ссылка на этот заголовок">¶</a></h2>
<p>To learn which functions are considered to be administrative, type <code class="docutils literal"><span class="pre">help()</span></code>.
A reference description also follows below:</p>
<span class="target" id="admin-snapshot"></span><dl class="function">
<dt id="lua-функция.box.snapshot">
<em class="property"> </em><code class="descclassname">box.</code><code class="descname">snapshot</code><big>(</big><big>)</big><a class="headerlink" href="#lua-функция.box.snapshot" title="Ссылка на это определение">¶</a></dt>
<dd><p>Take a snapshot of all data and store it in <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-snap-dir"><span class="std std-ref">snap_dir</span></a><code class="samp docutils literal"><span class="pre">/</span><em><span class="pre">&lt;latest-lsn&gt;</span></em><span class="pre">.snap</span></code>.
To take a snapshot, Tarantool first enters the delayed garbage collection
mode for all data. In this mode, tuples which were allocated before the
snapshot has started are not freed until the snapshot has finished. To
preserve consistency of the primary key, used to iterate over tuples, a
copy-on-write technique is employed. If the master process changes part
of a primary key, the corresponding process page is split, and the snapshot
process obtains an old copy of the page.
In effect, the snapshot process uses multi-version concurrency control
in order to avoid copying changes which are superseded while it is running.</p>
<p>Since a snapshot is written
sequentially, one can expect a very high write performance (averaging to
80MB/second on modern disks), which means an average database instance gets
saved in a matter of minutes. Note: as long as there are any changes to
the parent index memory through concurrent updates, there are going to be
page splits, and therefore one needs to have some extra free memory to run
this command. 10% of <a class="reference internal" href="../reference/configuration/index.html#cfg-storage-slab-alloc-arena"><span class="std std-ref">slab_alloc_arena</span></a> is, on average, sufficient.
This statement waits until a snapshot is taken and returns operation result.</p>
<p>Change Notice: prior to Tarantool version 1.6.6, the snapshot process caused
a fork, which could cause occasional latency spikes. Starting with
Tarantool version 1.6.6, the snapshot process creates a consistent
read view and writes this view to the snapshot file from a separate thread.</p>
<p>Although box.snapshot() does not cause a fork, there is a separate fiber
which may produce snapshots at regular intervals &#8211; see the discussion of
the <a class="reference internal" href="../reference/configuration/index.html#book-cfg-snapshot-daemon"><span class="std std-ref">snapshot daemon</span></a>.</p>
<p><strong>Example:</strong></p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">info</span><span class="p">.</span><span class="n">version</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">1.7.0-1216-g73f7154</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">snapshot</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ok</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">snapshot</span><span class="p">()</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">error</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">can&#39;t save snapshot, errno 17 (File exists)</span>
<span class="nn">...</span>
</pre></div>
</div>
<p>Taking a snapshot does not cause the server to start a new write-ahead log.
Once a snapshot is taken, old WALs can be deleted as long as all replicas
are up to date. But the WAL which was current at the time <code class="docutils literal"><span class="pre">box.snapshot()</span></code>
started must be kept for recovery, since it still contains log records
written after the start of <code class="docutils literal"><span class="pre">box.snapshot()</span></code>.</p>
<p>An alternative way to save a snapshot is to send the server SIGUSR1 UNIX
signal. While this approach could be handy, it is not recommended for use
in automation: a signal provides no way to find out whether the snapshot
was taken successfully or not.</p>
</dd></dl>

<dl class="function">
<dt id="lua-функция.coredump">
<em class="property"> </em><code class="descname">coredump</code><big>(</big><big>)</big><a class="headerlink" href="#lua-функция.coredump" title="Ссылка на это определение">¶</a></dt>
<dd><p>Fork and dump a core. Since Tarantool stores all tuples in memory, it can
take some time. Mainly useful for debugging.</p>
</dd></dl>

</div>
<div class="section" id="server-introspection">
<h2>5.5. Server introspection<a class="headerlink" href="#server-introspection" title="Ссылка на этот заголовок">¶</a></h2>
<p>For server introspection, use the reports provided by functions in the following
submodules:</p>
<ul class="simple">
<li><a class="reference internal" href="box/box_cfg.html#box-introspection-box-cfg"><span class="std std-ref">box.cfg</span></a> submodule
(check and specify all configuration parameters for the Tarantool server)</li>
<li><a class="reference internal" href="box/box_slab.html#box-introspection-box-slab"><span class="std std-ref">box.slab</span></a> submodule
(monitor the total use and fragmentation of memory allocated for storing
data in Tarantool)</li>
<li><a class="reference internal" href="box/box_info.html#box-introspection-box-info"><span class="std std-ref">box.info</span></a> submodule
(introspect Tarantool&#8217;s server variables)</li>
<li><a class="reference internal" href="box/box_stat.html#box-introspection-box-stat"><span class="std std-ref">box.stat</span></a> submodule
(introspect Tarantool&#8217;s request and network statistics)</li>
</ul>
</div>
<div class="section" id="replication">
<h2>5.6. Replication<a class="headerlink" href="#replication" title="Ссылка на этот заголовок">¶</a></h2>
<p id="index-box-replication">Replication allows multiple Tarantool servers to work on copies of the same
databases. The databases are kept in synch because each server can communicate
its changes to all the other servers. Servers which share the same databases
are a &#8220;cluster&#8221;. Each server in a cluster also has a numeric identifier which
is unique within the cluster, known as the &#8220;server id&#8221;.</p>
<p>To set up replication, it&#8217;s necessary to set up the master servers which
make the original data-change requests, set up the replica servers which
copy data-change requests from masters, and establish procedures for
recovery from a degraded state.</p>
<div class="section" id="replication-architecture">
<h3>5.6.1. Replication architecture<a class="headerlink" href="#replication-architecture" title="Ссылка на этот заголовок">¶</a></h3>
<p>A replica gets all updates from the master by continuously fetching and
applying its write-ahead log (WAL). Each record in the WAL represents a
single Tarantool data-change request such as INSERT or UPDATE or DELETE,
and is assigned a monotonically growing log sequence number (LSN). In
essence, Tarantool replication is row-based: each data change command is
fully deterministic and operates on a single tuple.</p>
<p>A stored program invocation is not written to the write-ahead log. Instead,
log events for actual data-change requests, performed by the Lua code, are
written to the log. This ensures that possible non-determinism of Lua does
not cause replication to go out of sync.</p>
</div>
<div class="section" id="setting-up-a-master">
<h3>5.6.2. Setting up a master<a class="headerlink" href="#setting-up-a-master" title="Ссылка на этот заголовок">¶</a></h3>
<p>To prepare the master for connections from the replica, it&#8217;s only necessary
to include &#8220;<a class="reference internal" href="../reference/configuration/index.html#cfg-basic-listen"><span class="std std-ref">listen</span></a>&#8221; in the initial <code class="docutils literal"><span class="pre">box.cfg</span></code> request,
for example <code class="docutils literal"><span class="pre">box.cfg{listen=3301}</span></code>. A master with enabled &#8220;listen&#8221; URI can accept
connections from as many replicas as necessary on that URI. Each replica
has its own <a class="reference internal" href="#index-monitoring-replica-actions"><span class="std std-ref">replication state</span></a>.</p>
</div>
<div class="section" id="setting-up-a-replica">
<h3>5.6.3. Setting up a replica<a class="headerlink" href="#setting-up-a-replica" title="Ссылка на этот заголовок">¶</a></h3>
<p>A server requires a valid snapshot (.snap) file. A snapshot file is created
for a server the first time that <code class="docutils literal"><span class="pre">box.cfg</span></code> occurs for it. If this first
<code class="docutils literal"><span class="pre">box.cfg</span></code> request occurs without a &#8220;replication source&#8221; clause, then the
server is a master and starts its own new cluster with a new unique UUID.
If this first <code class="docutils literal"><span class="pre">box.cfg</span></code> request occurs with a &#8220;replication source&#8221; clause,
then the server is a replica and its snapshot file, along with the cluster
information, is constructed from the write-ahead logs of the master.
Therefore, to start replication, specify <a class="reference internal" href="../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a>
in a <code class="docutils literal"><span class="pre">box.cfg</span></code> request. When a replica contacts a master for the first time,
it becomes part of a cluster. On subsequent occasions, it should always contact
a master in the same cluster.</p>
<p>Once connected to the master, the replica requests all changes that happened
after the latest local LSN. It is therefore necessary to keep WAL files on
the master host as long as there are replicas that haven&#8217;t applied them yet.
A replica can be &#8220;re-seeded&#8221; by deleting all its files (the snapshot .snap
file and the WAL .xlog files), then starting replication again - the replica
will then catch up with the master by retrieving all the master&#8217;s tuples.
Again, this procedure works only if the master&#8217;s WAL files are present.</p>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Replication parameters are &#8220;dynamic&#8221;, which allows the replica to become
a master and vice versa with the help of the
<a class="reference internal" href="box/box_cfg.html#box-introspection-box-cfg"><span class="std std-ref">box.cfg</span></a> statement.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">The replica does not inherit the master&#8217;s configuration parameters, such
as the ones that cause the <a class="reference internal" href="../reference/configuration/index.html#book-cfg-snapshot-daemon"><span class="std std-ref">snapshot daemon</span></a>
to run on the master. To get the same behavior, one would have to set the
relevant parameters explicitly so that they are the same on both master and
replica.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Примечание</p>
<p class="last">Replication requires privileges. Privileges for accessing spaces could be
granted directly to the user who will start the replica. However, it is more
usual to grant privileges for accessing spaces to a
<a class="reference internal" href="box/index.html#authentication-rep-role"><span class="std std-ref">role</span></a>, and then grant the role to the user
who will start the replica.</p>
</div>
</div>
<div class="section" id="recovering-from-a-degraded-state">
<h3>5.6.4. Recovering from a degraded state<a class="headerlink" href="#recovering-from-a-degraded-state" title="Ссылка на этот заголовок">¶</a></h3>
<p>&#8220;Degraded state&#8221; is a situation when the master becomes unavailable - due to
hardware or network failure, or due to a programming bug. There is no automatic
way for a replica to detect that the master is gone forever, since sources of
failure and replication environments vary significantly. So the detection of
degraded state requires a human inspection.</p>
<p>However, once a master failure is detected, the recovery is simple: declare
that the replica is now the new master, by saying
<span class="ccode">box.cfg{... listen=</span><span class="ccodei">URI</span><span class="ccode">}</span>.
Then, if there are updates on the old master that were not propagated before
the old master went down, they would have to be re-applied manually.</p>
</div>
<div class="section" id="quick-startup-of-a-new-simple-two-server-cluster">
<h3>5.6.5. Quick startup of a new simple two-server cluster<a class="headerlink" href="#quick-startup-of-a-new-simple-two-server-cluster" title="Ссылка на этот заголовок">¶</a></h3>
<p>Step 1. Start the first server thus:</p>
<pre class="highlight literal-block">
box.cfg{listen = <em>uri#1</em>}
-- replace with more restrictive request
box.schema.user.grant('guest', 'read,write,execute', 'universe')
box.snapshot()
</pre>
<p>... Now a new cluster exists.</p>
<p>Step 2. Check where the second server&#8217;s files will go by looking at its
directories (<a class="reference internal" href="../reference/configuration/index.html#cfg-basic-snap-dir"><span class="std std-ref">snap_dir</span></a> for snapshot files, <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-wal-dir"><span class="std std-ref">wal_dir</span></a> for .xlog files).
They must be empty - when the second server joins for the first time, it
has to be working with a clean state so that the initial copy of the first
server&#8217;s databases can happen without conflicts.</p>
<p>Step 3. Start the second server thus:</p>
<pre class="highlight literal-block">
box.cfg{
  listen = <em>uri#2</em>,
  replication_source = <em>uri#1</em>
}
</pre>
<p>... where <code class="docutils literal"><span class="pre">uri#1</span></code> = the <a class="reference internal" href="../reference/configuration/index.html#index-uri"><span class="std std-ref">URI</span></a> that the first server is listening on.</p>
<p>That&#8217;s all.</p>
<p>In this configuration, the first server is the &#8220;master&#8221; and the second server
is the &#8220;replica&#8221;. Henceforth every change that happens on the master will be
visible on the replica. A simple two-server cluster with the master on one
computer and the replica on a different computer is very common and provides
two benefits: FAILOVER (because if the master goes down then the replica can
take over), or LOAD BALANCING (because clients can connect to either the master
or the replica for select requests). Sometimes the replica may be configured with
the additional parameter <a class="reference internal" href="../reference/configuration/index.html#cfg-basic-read-only"><span class="std std-ref">read_only = true</span></a>.</p>
</div>
<div class="section" id="monitoring-a-replica-s-actions">
<span id="index-monitoring-replica-actions"></span><h3>5.6.6. Monitoring a replica&#8217;s actions<a class="headerlink" href="#monitoring-a-replica-s-actions" title="Ссылка на этот заголовок">¶</a></h3>
<p>In <a class="reference internal" href="box/box_info.html#box-introspection-box-info"><span class="std std-ref">box.info</span></a> there is a <code class="docutils literal"><span class="pre">box.info.replication.status</span></code> field:
&#8220;off&#8221;, &#8220;stopped&#8221;, &#8220;connecting&#8221;, &#8220;auth&#8221;, &#8220;follow&#8221;, or &#8220;disconnected&#8221;. <br />
If a replica&#8217;s status is &#8220;follow&#8221;, then there will be more fields &#8211;
the list is in the section <a class="reference internal" href="box/box_info.html#box-introspection-box-info"><span class="std std-ref">Submodule box.info</span></a>.</p>
<p>In the <a class="reference internal" href="../reference/reference_lua/log.html#log"><span class="std std-ref">log</span></a> there is a record of replication activity.
If a primary server is started with:</p>
<pre class="highlight literal-block">
box.cfg{
  &lt;...&gt;,
  logger = <em>log file name</em>,
  &lt;...&gt;
}
</pre>
<p>then there will be lines in the log file, containing the word &#8220;relay&#8221;,
when a replica connects or disconnects.</p>
</div>
<div class="section" id="preventing-duplicate-actions">
<span id="index-preventing-duplicate-actions"></span><h3>5.6.7. Preventing duplicate actions<a class="headerlink" href="#preventing-duplicate-actions" title="Ссылка на этот заголовок">¶</a></h3>
<p>Suppose that the replica tries to do something that the master has already done.
For example: <br />
<code class="docutils literal"><span class="pre">box.schema.space.create('X')</span></code> <br />
This would cause an error, &#8220;Space X exists&#8221;.
For this particular situation, the code could be changed to: <br />
<code class="docutils literal"><span class="pre">box.schema.space.create('X',</span> <span class="pre">{if_not_exists=true})</span></code> <br />
But there is a more general solution: the
<code class="samp docutils literal"><span class="pre">box.once(</span><em><span class="pre">key</span></em><span class="pre">,</span> <em><span class="pre">function</span></em><span class="pre">)</span></code> method.
If <code class="docutils literal"><span class="pre">box.once()</span></code> has been called before with the
same <code class="samp docutils literal"><em><span class="pre">key</span></em></code> value, then <code class="samp docutils literal"><em><span class="pre">function</span></em></code>
is ignored; otherwise <code class="samp docutils literal"><em><span class="pre">function</span></em></code> is executed.
Therefore, actions which should only occur once during the
life of a replicated session should be placed in a function
which is executed via <code class="docutils literal"><span class="pre">box.once()</span></code>. For example:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nf">f</span><span class="p">()</span>
  <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">X&#39;</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">space_creator&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="master-master-replication">
<h3>5.6.8. Master-master replication<a class="headerlink" href="#master-master-replication" title="Ссылка на этот заголовок">¶</a></h3>
<p>In the simple master-replica configuration, the master&#8217;s changes are seen by
the replica, but not vice versa, because the master was specified as the sole
replication source. In the master-master configuration,
also sometimes called multi-master configuration,
it&#8217;s possible to go both ways.
Starting with the simple configuration, the first server has to say:</p>
<pre class="highlight literal-block">
box.cfg{ replication_source = <em>uri#2</em> }
</pre>
<p>This request can be performed at any time &#8211;
<a class="reference internal" href="../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> is a dynamic parameter.</p>
<p>In this configuration, both servers are &#8220;masters&#8221; and both servers are
&#8220;replicas&#8221;. Henceforth every change that happens on either server will
be visible on the other. The failover benefit is still present, and the
load-balancing benefit is enhanced (because clients can connect to either
server for data-change requests as well as select requests).</p>
<p>If two operations for the same tuple take place &#8220;concurrently&#8221; (which can
involve a long interval because replication is asynchronous), and one of
the operations is <code class="docutils literal"><span class="pre">delete</span></code> or <code class="docutils literal"><span class="pre">replace</span></code>, there is a possibility that
servers will end up with different contents.</p>
</div>
<div class="section" id="all-the-what-if-questions">
<h3>5.6.9. All the &#8220;What If?&#8221; questions<a class="headerlink" href="#all-the-what-if-questions" title="Ссылка на этот заголовок">¶</a></h3>
<p>Q: What if there are more than two servers with master-master? <br />
A: On each server, specify the <a class="reference internal" href="../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a> for all the
others. For example, server #3 would have a request: <br />
<span class="ccode">box.cfg{</span> <br />
&nbsp; &nbsp; &nbsp; <span class="ccode">replication_source = {</span><span class="ccodei">uri#1, uri#2</span><span class="ccode">}</span> <br />
<span class="ccode">}</span></p>
<p>Q: What if a server should be taken out of the cluster? <br />
A: For a replica, run <code class="docutils literal"><span class="pre">box.cfg{}</span></code> again specifying a blank replication source: <br />
<code class="docutils literal"><span class="pre">box.cfg{replication_source=''}</span></code></p>
<p>Q: What if a server leaves the cluster? <br />
A: The other servers carry on. If the wayward server rejoins, it will
receive all the updates that the other servers made while it was away.</p>
<p>Q: What if two servers both change the same tuple? <br />
A: The last changer wins. For example, suppose that server#1 changes the
tuple, then server#2 changes the tuple. In that case server#2&#8217;s change
overrides whatever server#1 did. In order to keep track of who came last,
Tarantool implements a <a class="reference external" href="https://en.wikipedia.org/wiki/Vector_clock">vector clock</a>.</p>
<p>Q: What if two servers both insert the same tuple? <br />
A: If a master tries to insert a tuple which a replica has inserted
already, this is an example of a severe error. Replication stops.
It will have to be restarted manually.</p>
<p>Q: What if a master disappears and the replica must take over? <br />
A: A message will appear on the replica stating that the connection is
lost. The replica must now become independent, which can be done by
saying <code class="docutils literal"><span class="pre">box.cfg{replication_source=''}</span></code>.</p>
<p>Q: What if it&#8217;s necessary to know what cluster a server is in? <br />
A: The identification of the cluster is a UUID which is generated when the
first master starts for the first time. This UUID is stored in a tuple
of the <a class="reference internal" href="box/box_space.html#box-space-schema"><span class="std std-ref">box.space._schema</span></a> system space. So to see it, say:
<code class="docutils literal"><span class="pre">box.space._schema:select{'cluster'}</span></code></p>
<p>Q: What if it&#8217;s necessary to know what other servers belong in the cluster? <br />
A: The universal identification of a server is a UUID in <code class="docutils literal"><span class="pre">box.info.server.uuid</span></code>.
The ordinal identification of a server within a cluster is a number in <code class="docutils literal"><span class="pre">box.info.server.id</span></code>.
To see all the servers in the cluster, say:
<code class="docutils literal"><span class="pre">box.space._cluster:select{}</span></code>. This will return a table with all
{server.id, server.uuid} tuples for every server that has ever joined
the cluster.</p>
<p>Q: What if one of the server&#8217;s files is corrupted or deleted? <br />
A: Stop the server, destroy all the database files (the ones with extension
&#8220;snap&#8221; or &#8220;xlog&#8221; or &#8221;.inprogress&#8221;), restart the server, and catch up
with the master by contacting it again (just say
<code class="docutils literal"><span class="pre">box.cfg{...replication_source=...}</span></code>).</p>
<p>Q: What if replication causes security concerns? <br />
A: Prevent unauthorized replication sources by associating a password with
every user that has access privileges for the relevant spaces, and every
user that has a replication <a class="reference internal" href="box/index.html#authentication-rep-role"><span class="std std-ref">role</span></a>. That way,
the <a class="reference internal" href="../reference/configuration/index.html#index-uri"><span class="std std-ref">URI</span></a> for the <a class="reference internal" href="../reference/configuration/index.html#cfg-replication-replication-source"><span class="std std-ref">replication_source</span></a>
parameter will always have to have the long form <br />
<code class="docutils literal"><span class="pre">replication_source='username:password&#64;host:port'</span></code></p>
<p>Q: What if advanced users want to understand better how it all works? <br />
A: See the description of server startup with replication in the
<a class="reference internal" href="../dev_guide/internals_index.html#internals-replication"><span class="std std-ref">Internals</span></a> section.</p>
</div>
<div class="section" id="hands-on-replication-tutorial">
<h3>5.6.10. Hands-on replication tutorial<a class="headerlink" href="#hands-on-replication-tutorial" title="Ссылка на этот заголовок">¶</a></h3>
<p>After following the steps here, an administrator will have experience creating
a cluster and adding a replica.</p>
<p>Start two shells. Put them side by side on the screen. (This manual has a tabbed
display showing &#8220;Terminal #1&#8221;. Click the &#8220;Terminal #2&#8221; tab to switch to the
display of the other shell.)</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-1">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-1-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-1-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-1-content">
<div class="b-documentation-tab container" id="terminal-1-1">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-1-2">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>On the first shell, which we&#8217;ll call Terminal #1, execute these commands:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ~/tarantool_test_node_1/*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">password&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">execute&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">role&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">replication&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>The result is that a new cluster is set up, and the server&#8217;s UUID is displayed. Now the
screen looks like this: (except that UUID values are always different):</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-2">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-2-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-2-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-2-content">
<div class="b-documentation-tab container" id="terminal-2-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">$</span> ~/tarantool/src/tarantool: version 1.7.0-1724-g033ed69
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">password&#39;</span><span class="p">})</span>
<span class="go">&lt;...&gt; I&gt; creating ./00000000000000000000.xlog.inprogress&#39;</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">user</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">replicator&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">execute&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">role&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="s">replication&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;6190d919-1133-4452-b123-beca0b178b32&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-2-2">
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>On the second shell, which we&#8217;ll call Terminal #2, execute these commands:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ~/tarantool_test_node_2/*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>The result is that a replica is set up. Messages appear on Terminal #1
confirming that the replica has connected and that the WAL contents have
been shipped to the replica. Messages appear on Terminal #2 showing that
replication is starting. Also on Terminal#2 the _cluster UUID values are
displayed, and one of them is the same as the _cluster UUID value that was displayed
on Terminal #1, because both servers are in the same cluster.</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-3">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-3-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-3-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-3-content">
<div class="b-documentation-tab container" id="terminal-3-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 1</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_1
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;6190d919-1133-4452-b123-beca0b178b32&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-3-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">/home/username/tarantool/src/tarantool: version 1.7.0-1724-g033ed69</span>
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">&lt;...&gt;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; mapping 1073741824 bytes for tuple arena...</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive C&gt; starting replication from localhost:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; downloading a snapshot from 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; done</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; creating `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; saving snapshot `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; done</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: started</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: bound to 0.0.0.0:3302</span>
<span class="go">&lt;...&gt; [11243] wal/101/main I&gt; creating `./00000000000000000000.xlog.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; ready to accept requests</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>On Terminal #1, execute these requests:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Now the screen looks like this:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-4">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-4-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-4-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-4-content">
<div class="b-documentation-tab container" id="terminal-4-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-4-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># Terminal 2</span>
<span class="gp">$</span> mkdir -p ~/tarantool_test_node_2
<span class="gp">$</span> <span class="nb">cd</span> ~/tarantool_test_node_2
<span class="gp">$</span> rm -R ./*
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">/home/username/tarantool/src/tarantool: version 1.7.0-1724-g033ed69</span>
<span class="go">type &#39;help&#39; for interactive help</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3302</span><span class="p">,</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3301&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">&lt;...&gt;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; mapping 1073741824 bytes for tuple arena...</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive C&gt; starting replication from localhost:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; downloading a snapshot from 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/102/applier/localhost:3301 I&gt; done</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; creating `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; saving snapshot `./00000000000000000000.snap.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] snapshot/101/main I&gt; done</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: started</span>
<span class="go">&lt;...&gt; [11243] iproto I&gt; binary: bound to 0.0.0.0:3302</span>
<span class="go">&lt;...&gt; [11243] wal/101/main I&gt; creating `./00000000000000000000.xlog.inprogress&#39;</span>
<span class="go">&lt;...&gt; [11243] main/101/interactive I&gt; ready to accept requests</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>The creation and insertion were successful on Terminal #1. Nothing has happened
on Terminal #2.</p>
<p>On Terminal #2, execute these requests:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Now the screen looks like this (remember to click on the &#8220;Terminal #2&#8221; tab when looking at Terminal #2 results):</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-5">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-5-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-5-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-5-content">
<div class="b-documentation-tab container" id="terminal-5-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovery start</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recovering from `./00000000000000000000.snap&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; snapshot sent</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/101/main recovery.cc:211 W&gt; file</span>
<span class="go">      `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11031] relay/127.0.0.1:58734/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">tester&#39;</span><span class="p">)</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">i</span> <span class="o">=</span> <span class="n">s</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">primary&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-5-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">_cluster</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;6190d919-1133-4452-b123-beca0b178b32&#39;]</span>
<span class="go">  - [2, &#39;236230b8-af3e-406b-b709-15a60b44c20c&#39;]</span>
<span class="go">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>The selection and insertion were successful on Terminal #2. Nothing has
happened on Terminal #1.</p>
<p>On Terminal #1, execute these Tarantool requests and shell commands:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> os.exit<span class="o">()</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">$</span> ls -l ~/tarantool_test_node_2
</pre></div>
</div>
<p>Now Tarantool #1 is stopped. Messages appear on Terminal #2 announcing that fact.
The <code class="docutils literal"><span class="pre">ls</span> <span class="pre">-l</span></code> commands show that both servers have made snapshots, which have
similar sizes because they both contain the same tuples.</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-6">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-6-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-6-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-6-content">
<div class="b-documentation-tab container" id="terminal-6-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="go">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-6-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>On Terminal #2, ignore the error messages,
and execute these requests:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
</pre></div>
</div>
<p>Now the screen looks like this (ignoring the error
messages):</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-7">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-7-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-7-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-7-content">
<div class="b-documentation-tab container" id="terminal-7-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="go">$</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-7-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 coio.cc:352 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 6, aka 127.0.0.1:58734, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>Terminal #2 has done a select and an insert, even though Terminal #1 is down.</p>
<p>On Terminal #1 execute these commands:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">$</span> ~/tarantool/src/tarantool
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>Now the screen looks like this:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-8">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-8-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-8-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-8-content">
<div class="b-documentation-tab container" id="terminal-8-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #1&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_1
<span class="gp">tarantool&gt; </span><span class="nb">os.exit</span><span class="p">()</span>
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:12 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   634 May  5 11:45 00000000000000000000.xlog</span>
<span class="gp">$</span> ls -l ~/tarantool_test_node_2/
<span class="go">total 8</span>
<span class="go">-rw-rw-r-- 1  4925 May  5 11:20 00000000000000000000.snap</span>
<span class="go">-rw-rw-r-- 1   704 May  5 11:38 00000000000000000000.xlog</span>
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">&lt;...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;...&gt; [22612] main/101/interactive I&gt; ready to accept requests</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="go">- - [1, &#39;Tuple inserted on Terminal #1&#39;]</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-8-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; authenticated</span>
</pre></div>
</div>
</div>
</div>
</div>
<p>The master has reconnected to the cluster, and has NOT found what the replica
wrote while the master was away. That is not a surprise &#8211; the replica has not
been asked to act as a replication source.</p>
<p>On Terminal #1, say:</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">replicator:password@localhost:3302&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
</pre></div>
</div>
<p>The screen now looks like this:</p>
<div class="b-block-wrapper-doc container">
<div class="b-doc-catalog container" id="catalog-9">
<ul class="b-tab_switcher">
    <li class="b-tab_switcher-item">
        <a href="#terminal-9-1" class="b-tab_switcher-item-url p-active">Terminal #1</a>
    </li>
    <li class="b-tab_switcher-item">
        <a href="#terminal-9-2" class="b-tab_switcher-item-url">Terminal #2</a>
    </li>
</ul></div>
<div class="b-documentation-tab-content container" id="catalog-9-content">
<div class="b-documentation-tab container" id="terminal-9-1">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">$</span> ~/tarantool/src/tarantool
<span class="go">&lt;...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">}</span>
<span class="go">&lt;...&gt; [22612] main/101/interactive I&gt; ready to accept requests</span>
<span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span>
<span class="gp">         &gt; </span>  <span class="n">replication_source</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">replicator:password@localhost:3302&#39;</span>
<span class="gp">         &gt; </span><span class="p">}</span>
<span class="go">[28987] main/101/interactive C&gt; starting replication from localhost:3302</span>
<span class="nn">---</span>
<span class="nn">...</span>
<span class="go">[22612] main/101/interactive C&gt; starting replication from localhost:3302</span>
<span class="go">[22612] main/101/interactive I&gt; set &#39;replication_source&#39; configuration</span>
<span class="go">        option to &quot;replicator:password@localhost:3302&quot;</span>
<span class="go">[22612] main/104/applier/localhost:3302 I&gt; connected to 1.7.0 at 127.0.0.1:3302</span>
<span class="go">[22612] main/104/applier/localhost:3302 I&gt; authenticated</span>
<span class="go">[22612] wal/101/main I&gt; creating `./00000000000000000008.xlog.inprogress&#39;</span>
<span class="go">[22612] relay/127.0.0.1:33510/102/main I&gt; done `./00000000000000000000.xlog&#39;</span>
<span class="go">[22612] relay/127.0.0.1:33510/102/main I&gt; recover from `./00000000000000000008.xlog&#39;</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
<div class="b-documentation-tab container" id="terminal-9-2">
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="go">&lt;... ...&gt;</span>
<span class="gp">tarantool&gt; </span><span class="n">s</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Tuple inserted on Terminal #2&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; can&#39;t read row</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 !&gt; SystemError</span>
<span class="go">  unexpected EOF when reading from socket,</span>
<span class="go">  called on fd 10, aka 127.0.0.1:50884, peer of 127.0.0.1:3301: Broken pipe</span>
<span class="go">&lt;...&gt; [25579] main/103/replica/localhost:3301 I&gt; will retry every 1 second</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="nb">select</span><span class="p">({</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">iterator</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">GE&#39;</span><span class="p">})</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#1&#39;</span><span class="p p-Indicator">]</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span> <span class="s">&#39;Tuple</span><span class="nv"> </span><span class="s">inserted</span><span class="nv"> </span><span class="s">on</span><span class="nv"> </span><span class="s">Terminal</span><span class="nv"> </span><span class="s">#2&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">tester</span><span class="p">:</span><span class="n">insert</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">Another&#39;</span><span class="p">}</span>
<span class="nn">---</span>
<span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span> <span class="s">&#39;Another&#39;</span><span class="p p-Indicator">]</span>
<span class="nn">...</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; connected to 1.7.0 at 127.0.0.1:3301</span>
<span class="go">&lt;...&gt; [11243] main/105/applier/localhost:3301 I&gt; authenticated</span>
<span class="go">tarantool&gt;</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/101/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/101/main recovery.cc:211 W&gt; file</span>
<span class="go">     `./00000000000000000000.xlog` wasn&#39;t correctly closed</span>
<span class="go">&lt;...&gt; [11243] relay/127.0.0.1:36150/102/main I&gt; recover from `./00000000000000000000.xlog&#39;</span>
</pre></div>
</div>
</div>
</div>
<script>
    register_replication_tab(1);
    register_replication_tab(2);
    register_replication_tab(3);
    register_replication_tab(4);
    register_replication_tab(5);
    register_replication_tab(6);
    register_replication_tab(7);
    register_replication_tab(8);
    register_replication_tab(9);
</script></div>
<p>This shows that the two servers are once again in synch, and that each server
sees what the other server wrote.</p>
<p>To clean up, say &#8220;<code class="docutils literal"><span class="pre">os.exit()</span></code>&#8221; on both Terminal #1 and Terminal #2, and then
on either terminal say:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> ~
<span class="gp">$</span> rm -R ~/tarantool_test_node_1
<span class="gp">$</span> rm -R ~/tarantool_test_node_2
</pre></div>
</div>
</div>
</div>
<div class="section" id="backups">
<h2>5.7. Backups<a class="headerlink" href="#backups" title="Ссылка на этот заголовок">¶</a></h2>
<p>The exact procedure for backing up a database depends on:
how up-to-date the database must be,
how frequently backups must be taken,
whether it is okay to disrupt other users,
and whether the procedure should be optimized for size (saving disk space)
or for speed (saving time).
So there is a spectrum of possible policies, ranging from cold-and-simple
to hot-and-difficult.</p>
<div class="section" id="cold-backup">
<h3>5.7.1. Cold backup<a class="headerlink" href="#cold-backup" title="Ссылка на этот заголовок">¶</a></h3>
<p>In essence:
The last snapshot file is a backup of the entire database;
and the WAL files that are made after the last snapshot are incremental backups.
Therefore taking a backup is a matter of copying the snapshot and WAL files.</p>
<ol class="arabic simple">
<li>Prevent all users from writing to the database. This can be done by
shutting down the server, or by saying
<code class="docutils literal"><span class="pre">box.cfg{read_only=true}</span></code> and then ensuring that all earlier
writes are complete (<strong class="program">fsync</strong> can be used for this purpose).</li>
<li>If this is a backup of the whole database, say
<code class="samp docutils literal"><span class="pre">box.snapshot()</span></code>.</li>
<li>Use <strong class="program">tar</strong> to make a (possibly compressed) copy of the
latest <code class="file docutils literal"><span class="pre">.snap</span></code> and <code class="file docutils literal"><span class="pre">.xlog</span></code> files on the
<a class="reference internal" href="../reference/configuration/index.html#cfg-basic-snap-dir"><span class="std std-ref">snap_dir</span></a> and
<a class="reference internal" href="../reference/configuration/index.html#cfg-basic-wal-dir"><span class="std std-ref">wal_dir</span></a> directories.</li>
<li>If there is a security policy, encrypt the tar file.</li>
<li>Copy the tar file to a safe place.</li>
</ol>
<p>... Later, restoring the database is a matter of taking the
tar file and putting its contents back in the <code class="docutils literal"><span class="pre">snap_dir</span></code> and <code class="docutils literal"><span class="pre">wal_dir</span></code>
directories.</p>
</div>
<div class="section" id="continuous-remote-backup">
<h3>5.7.2. Continuous remote backup<a class="headerlink" href="#continuous-remote-backup" title="Ссылка на этот заголовок">¶</a></h3>
<p>In essence: <a class="reference internal" href="#index-box-replication"><span class="std std-ref">replication</span></a>
is useful for backup as well as for load balancing.
Therefore taking a backup is a matter of ensuring that any given
replica is up to date, and doing a cold backup on it.
Since all the other replicas continue to operate, this is not a
cold backup from the end user&#8217;s point of view. This could be
done on a regular basis, with a cron job or with a Tarantool fiber.</p>
</div>
<div class="section" id="hot-backup">
<h3>5.7.3. Hot backup<a class="headerlink" href="#hot-backup" title="Ссылка на этот заголовок">¶</a></h3>
<p>In essence:
The logged changes done since the last cold backup must be
secured, while the system is running.</p>
<p>For this purpose you need a &#8220;file copy&#8221; utility that will
do the copying remotely and continuously, copying only the
parts of a file that are changing. One such utility is
<a class="reference external" href="https://en.wikipedia.org/wiki/rsync">rsync</a>.</p>
<p>Alternatively, you need an ordinary file copy utility,
but there should be frequent production of new snapshot files or
new WAL files as changes occur, so that only the new files need to be copied.</p>
<p>Note re storage engine: vinyl databases require additional steps.</p>
</div>
</div>
<div class="section" id="updates-upgrades">
<h2>5.8. Updates/upgrades<a class="headerlink" href="#updates-upgrades" title="Ссылка на этот заголовок">¶</a></h2>
<div class="section" id="updating-tarantool-in-production">
<h3>5.8.1. Updating Tarantool in production<a class="headerlink" href="#updating-tarantool-in-production" title="Ссылка на этот заголовок">¶</a></h3>
<p>First, put your application&#8217;s business logic in a Tarantool-Lua module that
exports its functions for CALL.</p>
<p>For example, <code class="file docutils literal"><span class="pre">/usr/share/tarantool/myapp.lua</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="kd">local</span> <span class="k">function</span> <span class="nf">start</span><span class="p">()</span>
  <span class="c1">-- Initial version</span>
  <span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">myapp:.1.0&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
  <span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">somedata&quot;</span><span class="p">)</span>
  <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">:</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">primary&quot;</span><span class="p">)</span>
  <span class="o">...</span>

  <span class="c1">-- migration code from 1.0 to 1.1</span>
  <span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">myapp:.v1.1&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
  <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">.</span><span class="n">index</span><span class="p">.</span><span class="n">primary</span><span class="p">:</span><span class="n">alter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="o">...</span>

  <span class="c1">-- migration code from 1.1 to 1.2</span>
  <span class="n">box</span><span class="p">.</span><span class="n">once</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">myapp:.v1.2&quot;</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
  <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">.</span><span class="n">space</span><span class="p">:</span><span class="n">alter</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="n">box</span><span class="p">.</span><span class="n">space</span><span class="p">.</span><span class="n">somedata</span><span class="p">:</span><span class="n">insert</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
  <span class="o">...</span>
<span class="k">end</span>

<span class="c1">-- start some background fibers if you need</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">stop</span><span class="p">()</span>
  <span class="c1">-- stop all background fibers and cleanup resources</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">api_for_call</span><span class="p">(</span><span class="n">xxx</span><span class="p">)</span>
  <span class="c1">-- do some business</span>
<span class="k">end</span>

<span class="k">return</span> <span class="p">{</span>
  <span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
  <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span><span class="p">;</span>
  <span class="n">api_for_call</span> <span class="o">=</span> <span class="n">api_for_call</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This file is maintained by the application&#8217;s developers. On its side,
Tarantool Team provides templates for you to
<a class="reference external" href="https://github.com/tarantool/modulekit">assemble deb/rpm packages</a>
and utilities to quickly
<a class="reference external" href="https://github.com/tarantool/build">assemble packages for specific platforms</a>.
If needed, you can split applications into standalone files and/or modules.</p>
<p>Second, put an initialization script to the
<code class="file docutils literal"><span class="pre">/etc/tarantool/instances.available</span></code> directory.</p>
<p>For example, <code class="file docutils literal"><span class="pre">/etc/tarantool/instances.available/myappcfg.lua</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="cp">#!/usr/bin/env tarantool</span>

<span class="n">box</span><span class="p">.</span><span class="n">cfg</span> <span class="p">{</span>
  <span class="n">listen</span> <span class="o">=</span> <span class="mi">3301</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">myapp</span> <span class="o">~=</span> <span class="kc">nil</span> <span class="k">then</span>
  <span class="c1">-- hot code reload using tarantoolctl or dofile()</span>

  <span class="c1">-- unload old application</span>
  <span class="n">myapp</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
  <span class="c1">-- clear cache for loaded modules and dependencies</span>
  <span class="nb">package.loaded</span><span class="p">[</span><span class="s1">&#39;</span><span class="s">myapp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span>
  <span class="nb">package.loaded</span><span class="p">[</span><span class="s1">&#39;</span><span class="s">somedep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">;</span> <span class="c1">-- dependency of &#39;myapp&#39;</span>
<span class="k">end</span>

<span class="c1">-- load a new version of app and all dependencies</span>
<span class="n">myapp</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">myapp&#39;</span><span class="p">).</span><span class="n">start</span><span class="p">({</span><span class="n">some</span> <span class="n">app</span> <span class="n">options</span> <span class="n">controlled</span> <span class="n">by</span> <span class="n">sysadmins</span><span class="p">})</span>
</pre></div>
</div>
<p>As a more detailed example, you can take the <code class="file docutils literal"><span class="pre">example.lua</span></code> script that
ships with Tarantool and defines all configuration options.</p>
<p>This initialization script is actually a configuration file and should be
maintained by system administrators, while developers only provide a template.</p>
<p>Now update your app file in <code class="file docutils literal"><span class="pre">/usr/share/tarantool</span></code>. Replace your
application file (for example, <code class="file docutils literal"><span class="pre">/usr/share/tarantool/myapp.lua</span></code>) and
manually reload the <code class="file docutils literal"><span class="pre">myappcfg.lua</span></code> initialization script using
<strong class="program">tarantoolctl</strong>:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl <span class="nb">eval</span> /etc/tarantool/instance.enabled/myappcfg.lua
</pre></div>
</div>
<p>After that, you need to manually flush the cache of <code class="docutils literal"><span class="pre">package.loaded</span></code> modules.</p>
<p>For deb/rpm packages, you can add the <code class="docutils literal"><span class="pre">tarantoolctl</span> <span class="pre">eval</span></code> instruction directly
into Tarantool&#8217;s specification in <code class="file docutils literal"><span class="pre">RPM.spec</span></code> and the
<code class="file docutils literal"><span class="pre">/debian</span></code> directory.</p>
<p>Finally, clients make a CALL to <code class="docutils literal"><span class="pre">myapp.api_for_call</span></code> and other API functions.</p>
<p>In the case of <code class="docutils literal"><span class="pre">tarantool-http</span></code>, there is no need to start the binary protocol
at all.</p>
</div>
<div class="section" id="upgrading-a-tarantool-database">
<h3>5.8.2. Upgrading a Tarantool database<a class="headerlink" href="#upgrading-a-tarantool-database" title="Ссылка на этот заголовок">¶</a></h3>
<p>This information applies for users who created databases with older
versions of the Tarantool server, and have now installed a newer version.
The request to make in this case is: <code class="samp docutils literal"><span class="pre">box.schema.upgrade()</span></code>.</p>
<p>For example, here is what happens when one runs <code class="samp docutils literal"><span class="pre">box.schema.upgrade()</span></code>
with a database that was created in early 2015. Only a small part of the output
is shown.</p>
<div class="highlight-tarantoolsession"><div class="highlight"><pre><span></span><span class="gp">tarantool&gt; </span><span class="n">box</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">upgrade</span><span class="p">()</span>
<span class="go">alter index primary on _space set options to {&quot;unique&quot;:true}, parts to [[0,&quot;unsigned&quot;]]</span>
<span class="go">alter space _schema set options to {}</span>
<span class="go">create view _vindex...</span>
<span class="go">grant read access to &#39;public&#39; role for _vindex view</span>
<span class="go">set schema version to 1.7.0</span>
<span class="nn">---</span>
<span class="nn">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="server-signal-handling">
<h2>5.9. Server signal handling<a class="headerlink" href="#server-signal-handling" title="Ссылка на этот заголовок">¶</a></h2>
<p>The server processes these signals during the main thread event loop:</p>
<dl class="glossary docutils">
<dt id="term-sighup">SIGHUP</dt>
<dd>may cause log file rotation, see
<a class="reference internal" href="../reference/configuration/index.html#cfg-logging-logging-example"><span class="std std-ref">the example in section &#8220;Logging&#8221;</span></a>.</dd>
<dt id="term-sigusr1">SIGUSR1</dt>
<dd>may cause saving of a snapshot, see the description of
<a class="reference internal" href="#admin-snapshot"><span class="std std-ref">box.snapshot</span></a>.</dd>
<dt id="term-sigterm">SIGTERM</dt>
<dd>may cause graceful shutdown (information will be saved first).</dd>
<dt id="term-sigint">SIGINT</dt>
<dd>(also known as keyboard interrupt) may cause graceful shutdown.</dd>
<dt id="term-sigkill">SIGKILL</dt>
<dd>causes shutdown.</dd>
</dl>
<p>Other signals will result in behavior defined by the operating system. Signals
other than SIGKILL may be ignored, especially if the server is executing a
long-running procedure which prevents return to the main thread event loop.</p>
</div>
<div class="section" id="process-title">
<span id="administration-proctitle"></span><h2>5.10. Process title<a class="headerlink" href="#process-title" title="Ссылка на этот заголовок">¶</a></h2>
<p>Linux and FreeBSD operating systems allow a running process to modify its title,
which otherwise contains the program name. Tarantool uses this feature to help
meet the needs of system administration, such as figuring out what services are
running on a host, their status, and so on.</p>
<p>A Tarantool server&#8217;s process title has these components:</p>
<p><code class="extsamp docutils literal"><strong><span class="pre">program_name</span></strong> <span class="pre">[</span><strong><span class="pre">initialization_file_name</span></strong><span class="pre">]</span> <strong><span class="pre">&lt;role_name&gt;</span></strong> <span class="pre">[</span><strong><span class="pre">custom_proc_title</span></strong><span class="pre">]</span></code></p>
<ul class="simple">
<li><strong>program_name</strong> is typically &#8220;tarantool&#8221;.</li>
<li><strong>initialization_file_name</strong> is the name of an
<a class="reference internal" href="../reference/configuration/index.html#index-init-label"><span class="std std-ref">initialization file</span></a>, if one was specified.</li>
<li><strong>role_name</strong> is:<ul>
<li>&#8220;running&#8221; (ordinary node &#8220;ready to accept requests&#8221;),</li>
<li>&#8220;loading&#8221; (ordinary node recovering from old snap and wal files),</li>
<li>&#8220;orphan&#8221; (not in a cluster),</li>
<li>&#8220;hot_standby&#8221;, or</li>
<li>&#8220;dumper&#8221; + process-id (saving a snapshot).</li>
</ul>
</li>
<li><strong>custom_proc_title</strong> is taken from the
<a class="reference internal" href="../reference/configuration/index.html#cfg-basic-custom-proc-title"><span class="std std-ref">custom_proc_title</span></a> configuration parameter,
if one was specified.</li>
</ul>
<p>For example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ps -AF <span class="p">|</span> grep tarantool
<span class="go">1000     17337 16716  1 91362  6916   0 11:07 pts/5    00:00:13 tarantool script.lua &lt;running&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="system-specific-administration-notes">
<h2>5.11. System-specific administration notes<a class="headerlink" href="#system-specific-administration-notes" title="Ссылка на этот заголовок">¶</a></h2>
<p>This section will contain information about issues or features which exist
on some platforms but not others - for example, on certain versions of a
particular Linux distribution.</p>
<div class="section" id="debian-gnu-linux-and-ubuntu">
<h3>5.11.1. Debian GNU/Linux and Ubuntu<a class="headerlink" href="#debian-gnu-linux-and-ubuntu" title="Ссылка на этот заголовок">¶</a></h3>
<p>Setting up an instance:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> ln -s /etc/tarantool/instances.available/*instance-name.cfg* /etc/tarantool/instances.enabled/
</pre></div>
</div>
<p>Starting all instances:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> service tarantool start
</pre></div>
</div>
<p>Stopping all instances:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> service tarantool stop
</pre></div>
</div>
<p>Starting/stopping one instance:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> service tarantool-instance-name start/stop
</pre></div>
</div>
</div>
<div class="section" id="fedora-rhel-centos">
<h3>5.11.2. Fedora, RHEL, CentOS<a class="headerlink" href="#fedora-rhel-centos" title="Ссылка на этот заголовок">¶</a></h3>
<p>There are no known permanent issues. For transient issues, go to
<a class="reference external" href="http://github.com/tarantool/tarantool/issues">http://github.com/tarantool/tarantool/issues</a> and enter &#8220;RHEL&#8221; or
&#8220;CentOS&#8221; or &#8220;Fedora&#8221; or &#8220;Red Hat&#8221; in the search box.</p>
</div>
<div class="section" id="freebsd">
<h3>5.11.3. FreeBSD<a class="headerlink" href="#freebsd" title="Ссылка на этот заголовок">¶</a></h3>
<p>There are no known permanent issues. For transient issues, go to
<a class="reference external" href="http://github.com/tarantool/tarantool/issues">http://github.com/tarantool/tarantool/issues</a> and enter &#8220;FreeBSD&#8221;
in the search box.</p>
</div>
<div class="section" id="mac-os-x">
<h3>5.11.4. Mac OS X<a class="headerlink" href="#mac-os-x" title="Ссылка на этот заголовок">¶</a></h3>
<p>There are no known permanent issues. For transient issues, go to
<a class="reference external" href="http://github.com/tarantool/tarantool/issues">http://github.com/tarantool/tarantool/issues</a> and enter &#8220;OS X&#8221; in
the search box.</p>
</div>
</div>
<div class="section" id="notes-for-systemd-users">
<h2>5.12. Notes for systemd users<a class="headerlink" href="#notes-for-systemd-users" title="Ссылка на этот заголовок">¶</a></h2>
<p>Tarantool fully supports <strong class="program">systemd</strong> for managing instances and
supervising database daemons.</p>
<div class="section" id="instance-management">
<h3>5.12.1. Instance management<a class="headerlink" href="#instance-management" title="Ссылка на этот заголовок">¶</a></h3>
<p>Tarantool was designed to have multiple running instances of Tarantool
on the same machine. Use
<code class="samp docutils literal"><span class="pre">systemctl</span> <em><span class="pre">start|stop|restart|status</span></em> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code>
to manage your databases and Lua applications.</p>
<div class="section" id="creating-instances">
<h4>5.12.1.1. Creating instances<a class="headerlink" href="#creating-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Simply put your Lua configuration to
<code class="file docutils literal"><span class="pre">/etc/tarantool/instances.available/$</span><em><span class="pre">MYAPP</span></em><span class="pre">.lua</span></code>:</p>
<div class="highlight-lua"><div class="highlight"><pre><span></span><span class="n">box</span><span class="p">.</span><span class="n">cfg</span><span class="p">{</span><span class="n">listen</span> <span class="o">=</span> <span class="mi">3313</span><span class="p">}</span>
<span class="nb">require</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">myappcode&#39;</span><span class="p">).</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>(this minimal example is sufficient).</p>
<p>Another starting point could be the <code class="file docutils literal"><span class="pre">example.lua</span></code> script that ships with
Tarantool and defines all options.</p>
</div>
<div class="section" id="starting-instances">
<h4>5.12.1.2. Starting instances<a class="headerlink" href="#starting-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Use <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code> to start <code class="docutils literal"><span class="pre">${MYAPP}</span></code> instance:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl start tarantool@example
<span class="gp">$</span> ps axuf<span class="p">|</span>grep exampl<span class="o">[</span>e<span class="o">]</span>
<span class="go">taranto+  5350  1.3  0.3 1448872 7736 ?        Ssl  20:05   0:28 tarantool example.lua &lt;running&gt;</span>
</pre></div>
</div>
<p>(console examples here and further on are for Fedora).</p>
<p>Use <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code> to enable <code class="docutils literal"><span class="pre">${MYAPP}</span></code> instance
for auto-load during system startup.</p>
</div>
<div class="section" id="monitoring-instances">
<h4>5.12.1.3. Monitoring instances<a class="headerlink" href="#monitoring-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Use <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code> to check information about
<code class="docutils literal"><span class="pre">${MYAPP}</span></code> instance:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl status tarantool@example
<span class="go">tarantool@example.service - Tarantool Database Server</span>
<span class="go">Loaded: loaded (/etc/systemd/system/tarantool@.service; disabled; vendor preset: disabled)</span>
<span class="go">Active: active (running)</span>
<span class="go">Docs: man:tarantool(1)</span>
<span class="go">Process: 5346 ExecStart=/usr/bin/tarantoolctl start %I (code=exited, status=0/SUCCESS)</span>
<span class="go">Main PID: 5350 (tarantool)</span>
<span class="go">Tasks: 11 (limit: 512)</span>
<span class="go">CGroup: /system.slice/system-tarantool.slice/tarantool@example.service</span>
<span class="go">+ 5350 tarantool example.lua &lt;running&gt;</span>
</pre></div>
</div>
<p>Use <code class="samp docutils literal"><span class="pre">journalctl</span> <span class="pre">-u</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code> to check the boot log:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> journalctl -u tarantool@example -n 5
<span class="go">-- Logs begin at Fri 2016-01-08 12:21:53 MSK, end at Thu 2016-01-21 21:17:47 MSK. --</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain systemd[1]: Stopped Tarantool Database Server.</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain systemd[1]: Starting Tarantool Database Server...</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain tarantoolctl[5969]: /usr/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain tarantoolctl[5969]: /usr/bin/tarantoolctl: Starting instance...</span>
<span class="go">Jan 21 21:17:47 localhost.localdomain systemd[1]: Started Tarantool Database Server</span>
</pre></div>
</div>
</div>
<div class="section" id="attaching-to-instances">
<h4>5.12.1.4. Attaching to instances<a class="headerlink" href="#attaching-to-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>You can attach to a running Tarantool instance and evaluate some Lua code using
the <strong class="program">tarantoolctl</strong> utility:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; 1 + 1</span>
<span class="go">---</span>
<span class="go">- 2</span>
<span class="go">...</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-logs">
<h4>5.12.1.5. Checking logs<a class="headerlink" href="#checking-logs" title="Ссылка на этот заголовок">¶</a></h4>
<p>Tarantool logs important events to <code class="file docutils literal"><span class="pre">/var/log/tarantool/$</span><em><span class="pre">MYAPP</span></em><span class="pre">.log</span></code>.</p>
<p>Let&#8217;s write something to the log file:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; require(&#39;log&#39;).info(&quot;Hello for README.systemd readers&quot;)</span>
<span class="go">---</span>
<span class="go">...</span>
</pre></div>
</div>
<p>Then check the logs:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> tail /var/log/tarantool/example.log
<span class="go">2016-01-21 21:09:45.982 [5914] iproto I&gt; binary: started</span>
<span class="go">2016-01-21 21:09:45.982 [5914] iproto I&gt; binary: bound to 0.0.0.0:3301</span>
<span class="go">2016-01-21 21:09:45.983 [5914] main/101/tarantoolctl I&gt; ready to accept requests</span>
<span class="go">2016-01-21 21:09:45.983 [5914] main/101/example I&gt; Run console at /var/run/tarantool/example.control</span>
<span class="go">2016-01-21 21:09:45.984 [5914] main/101/example I&gt; tcp_server: remove dead UNIX socket: /var/run/tarantool/example.control</span>
<span class="go">2016-01-21 21:09:45.984 [5914] main/104/console/unix/:/var/run/tarant I&gt; started</span>
<span class="go">2016-01-21 21:09:45.985 [5914] main C&gt; entering the event loop</span>
<span class="go">2016-01-21 21:14:43.320 [5914] main/105/console/unix/: I&gt; client unix/: connected</span>
<span class="go">2016-01-21 21:15:07.115 [5914] main/105/console/unix/: I&gt; Hello for README.systemd readers</span>
<span class="go">2016-01-21 21:15:09.250 [5914] main/105/console/unix/: I&gt; client unix/: disconnected</span>
</pre></div>
</div>
<p>Log rotation is enabled by default if you have <strong class="program">logrotate</strong> installed.
Please configure <code class="file docutils literal"><span class="pre">/etc/logrotate.d/tarantool</span></code> to change the default
behavior.</p>
</div>
<div class="section" id="stopping-instances">
<h4>5.12.1.6. Stopping instances<a class="headerlink" href="#stopping-instances" title="Ссылка на этот заголовок">¶</a></h4>
<p>Use <code class="samp docutils literal"><span class="pre">systemctl</span> <span class="pre">stop</span> <span class="pre">tarantool&#64;$</span><em><span class="pre">MYAPP</span></em></code> to see information about the running
<code class="docutils literal"><span class="pre">${MYAPP}</span></code> instance.</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl stop tarantool@example
</pre></div>
</div>
</div>
</div>
<div class="section" id="daemon-supervision">
<h3>5.12.2. Daemon supervision<a class="headerlink" href="#daemon-supervision" title="Ссылка на этот заголовок">¶</a></h3>
<p>All instances are automatically restarted by <strong class="program">systemd</strong> in case of failure.</p>
<p>Let&#8217;s try to destroy an instance:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl status tarantool@example<span class="p">|</span>grep PID
<span class="go">Main PID: 5885 (tarantool)</span>
<span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; os.exit(-1)</span>
<span class="go">/bin/tarantoolctl: unix/:/var/run/tarantool/example.control: Remote host closed connection</span>
</pre></div>
</div>
<p>Now let&#8217;s make sure that <strong class="program">systemd</strong> has revived our Tarantool instance:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> systemctl status tarantool@example<span class="p">|</span>grep PID
<span class="go">Main PID: 5914 (tarantool)</span>
</pre></div>
</div>
<p>Finally, let&#8217;s check the boot logs:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> journalctl -u tarantool@example -n 8
<span class="go">-- Logs begin at Fri 2016-01-08 12:21:53 MSK, end at Thu 2016-01-21 21:09:45 MSK. --</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: tarantool@example.service: Unit entered failed state.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: tarantool@example.service: Failed with result &#39;exit-code&#39;.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: tarantool@example.service: Service hold-off time over, scheduling restart.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: Stopped Tarantool Database Server.</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: Starting Tarantool Database Server...</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain tarantoolctl[5910]: /usr/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain tarantoolctl[5910]: /usr/bin/tarantoolctl: Starting instance...</span>
<span class="go">Jan 21 21:09:45 localhost.localdomain systemd[1]: Started Tarantool Database Server.</span>
</pre></div>
</div>
</div>
<div class="section" id="customizing-the-service-file">
<h3>5.12.3. Customizing the service file<a class="headerlink" href="#customizing-the-service-file" title="Ссылка на этот заголовок">¶</a></h3>
<p>Please don&#8217;t modify the <code class="file docutils literal"><span class="pre">tarantool&#64;.service</span></code> file in-place, because it will be
overwritten during package upgrades. It is recommended to copy this file to
<code class="file docutils literal"><span class="pre">/etc/systemd/system</span></code> and then modify the required settings. Alternatively,
you can create a directory named <code class="file docutils literal"><span class="pre">unit.d/</span></code> within <code class="file docutils literal"><span class="pre">/etc/systemd/system</span></code> and
put there a drop-in file <code class="file docutils literal"><span class="pre">name.conf</span></code> that only changes the required settings.
Please see <code class="docutils literal"><span class="pre">systemd.unit(5)</span></code> manual page for additional information.</p>
</div>
<div class="section" id="debugging">
<h3>5.12.4. Debugging<a class="headerlink" href="#debugging" title="Ссылка на этот заголовок">¶</a></h3>
<p><strong class="program">coredumpctl</strong> automatically saves core dumps and stack traces in case
of a crash. Here is how it works:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># !!! please never do this on the production system !!!</span>
<span class="gp">$</span> tarantoolctl enter example
<span class="go">/bin/tarantoolctl: Found example.lua in /etc/tarantool/instances.available</span>
<span class="go">/bin/tarantoolctl: Connecting to /var/run/tarantool/example.control</span>
<span class="go">/bin/tarantoolctl: connected to unix/:/var/run/tarantool/example.control</span>
<span class="go">unix/:/var/run/tarantool/example.control&gt; require(&#39;ffi&#39;).cast(&#39;char *&#39;, 0)[0] = 48</span>
<span class="go">/bin/tarantoolctl: unix/:/var/run/tarantool/example.control: Remote host closed connection</span>
</pre></div>
</div>
<p><code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">list</span> <span class="pre">/usr/bin/tarantool</span></code> displays the latest crashes of the
Tarantool daemon:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> coredumpctl list /usr/bin/tarantool
<span class="go">MTIME                            PID   UID   GID SIG PRESENT EXE</span>
<span class="go">Sat 2016-01-23 15:21:24 MSK   20681  1000  1000   6   /usr/bin/tarantool</span>
<span class="go">Sat 2016-01-23 15:51:56 MSK   21035   995   992   6   /usr/bin/tarantool</span>
</pre></div>
</div>
<p><code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">info</span> <span class="pre">&lt;pid&gt;</span></code> shows the stack trace and other useful information:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> coredumpctl info 21035
<span class="go">          PID: 21035 (tarantool)</span>
<span class="go">          UID: 995 (tarantool)</span>
<span class="go">          GID: 992 (tarantool)</span>
<span class="go">       Signal: 6 (ABRT)</span>
<span class="go">    Timestamp: Sat 2016-01-23 15:51:42 MSK (4h 36min ago)</span>
<span class="go"> Command Line: tarantool example.lua &lt;running&gt;</span>
<span class="go">   Executable: /usr/bin/tarantool</span>
<span class="go">Control Group: /system.slice/system-tarantool.slice/tarantool@example.service</span>
<span class="go">         Unit: tarantool@example.service</span>
<span class="go">        Slice: system-tarantool.slice</span>
<span class="go">      Boot ID: 7c686e2ef4dc4e3ea59122757e3067e2</span>
<span class="go">   Machine ID: a4a878729c654c7093dc6693f6a8e5ee</span>
<span class="go">     Hostname: localhost.localdomain</span>
<span class="go">      Message: Process 21035 (tarantool) of user 995 dumped core.</span>

<span class="go">               Stack trace of thread 21035:</span>
<span class="gp">               #</span><span class="m">0</span>  0x00007f84993aa618 raise <span class="o">(</span>libc.so.6<span class="o">)</span>
<span class="gp">               #</span><span class="m">1</span>  0x00007f84993ac21a abort <span class="o">(</span>libc.so.6<span class="o">)</span>
<span class="gp">               #</span><span class="m">2</span>  0x0000560d0a9e9233 _ZL12sig_fatal_cbi <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">3</span>  0x00007f849a211220 __restore_rt <span class="o">(</span>libpthread.so.0<span class="o">)</span>
<span class="gp">               #</span><span class="m">4</span>  0x0000560d0aaa5d9d lj_cconv_ct_ct <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">5</span>  0x0000560d0aaa687f lj_cconv_ct_tv <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">6</span>  0x0000560d0aaabe33 lj_cf_ffi_meta___newindex <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">7</span>  0x0000560d0aaae2f7 lj_BC_FUNCC <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">8</span>  0x0000560d0aa9aabd lua_pcall <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">9</span>  0x0000560d0aa71400 lbox_call <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">10</span> 0x0000560d0aa6ce36 lua_fiber_run_f <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">11</span> 0x0000560d0a9e8d0c _ZL16fiber_cxx_invokePFiP13__va_list_tagES0_ <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">12</span> 0x0000560d0aa7b255 fiber_loop <span class="o">(</span>tarantool<span class="o">)</span>
<span class="gp">               #</span><span class="m">13</span> 0x0000560d0ab38ed1 coro_init <span class="o">(</span>tarantool<span class="o">)</span>
<span class="go">               ...</span>
</pre></div>
</div>
<p><code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">-o</span> <span class="pre">filename.core</span> <span class="pre">info</span> <span class="pre">&lt;pid&gt;</span></code> saves the core dump into a file.</p>
<p><code class="samp docutils literal"><span class="pre">coredumpctl</span> <span class="pre">gdb</span> <span class="pre">&lt;pid&gt;</span></code> starts <strong class="program">gdb</strong> on the core dump.</p>
<p>It is highly recommended to install the <code class="docutils literal"><span class="pre">tarantool-debuginfo</span></code> package to improve
<strong class="program">gdb</strong> experience. Example:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> dnf debuginfo-install tarantool
</pre></div>
</div>
<p><strong class="program">gdb</strong> also provides information about the <code class="docutils literal"><span class="pre">debuginfo</span></code> packages you need to install:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="c1"># gdb -p &lt;pid&gt;</span>
<span class="go">...</span>
<span class="go">Missing separate debuginfos, use: dnf debuginfo-install</span>
<span class="go">glibc-2.22.90-26.fc24.x86_64 krb5-libs-1.14-12.fc24.x86_64</span>
<span class="go">libgcc-5.3.1-3.fc24.x86_64 libgomp-5.3.1-3.fc24.x86_64</span>
<span class="go">libselinux-2.4-6.fc24.x86_64 libstdc++-5.3.1-3.fc24.x86_64</span>
<span class="go">libyaml-0.1.6-7.fc23.x86_64 ncurses-libs-6.0-1.20150810.fc24.x86_64</span>
<span class="go">openssl-libs-1.0.2e-3.fc24.x86_64</span>
</pre></div>
</div>
<p>Symbol names are present in stack traces even if you don&#8217;t have the
<code class="docutils literal"><span class="pre">tarantool-debuginfo</span></code> package installed.</p>
<p>For additional information, please refer to the documentation provided with your
Linux distribution.</p>
</div>
<div class="section" id="precautions">
<h3>5.12.5. Precautions<a class="headerlink" href="#precautions" title="Ссылка на этот заголовок">¶</a></h3>
<ul class="simple">
<li>Please don&#8217;t use <code class="docutils literal"><span class="pre">tarantoolctl</span> <span class="pre">{start,stop,restart}</span></code> to control instances
started by <strong class="program">systemd</strong>. It is still possible to use
<strong class="program">tarantoolctl</strong> to start and stop instances from your local directories
(e.g. <code class="file docutils literal"><span class="pre">$</span><em><span class="pre">HOME</span></em></code>) without obtaining <code class="docutils literal"><span class="pre">ROOT</span></code> access.</li>
<li><strong class="program">tarantoolctl</strong> is configured to work properly with <strong class="program">systemd</strong>.
Please don&#8217;t modify system-wide settings of <strong class="program">tarantoolctl</strong>, such as
paths, directory permissions and usernames. Otherwise, you have a chance to
shoot yourself in the foot.</li>
<li><strong class="program">systemd</strong> scripts are maintained by the Tarantool Team
(<a class="reference external" href="http://tarantool.org">http://tarantool.org</a>). Please file tickets directly to the upstream&#8217;s bug
tracker (<a class="reference external" href="https://github.com/tarantool/tarantool/issues/">https://github.com/tarantool/tarantool/issues/</a>) rather than to your
Linux distribution.</li>
</ul>
</div>
<div class="section" id="limitations">
<h3>5.12.6. Limitations<a class="headerlink" href="#limitations" title="Ссылка на этот заголовок">¶</a></h3>
<p>These limitations exist due to decisions by packagers
to support systemd alongside sysvinit.</p>
<p><code class="docutils literal"><span class="pre">/etc/init.d/tarantool</span> <span class="pre">start</span></code> under systemd,
or <code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">tarantool</span></code> (without an &#64;instance argument),
will start only those instances which were enabled before reboot
or before the last time that systemd was reloaded with <code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">daemon-reload</span></code>.</p>
<p>(<code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">tarantool</span></code>, without an &#64;instance argument,
is provided only for interoperability with sysvinit scripts.
Please use <code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">tarantool&#64;instance</span></code> instead.)</p>
<p><code class="docutils literal"><span class="pre">/etc/init.d/tarantool</span> <span class="pre">stop</span></code> under systemd,
or <code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">tarantool</span> <span class="pre">stop</span></code> (without an &#64;instance argument),
will do nothing.</p>
<p>Starting with Tarantool version 1.7.1.42, a new version of
tarantool-common is required.
(tarantool-common is a downloadable package which provides
scripts to work with tarantool configuration and log files.)
An attempt to upgrade tarantool-common will cause restart of all instances.</p>
</div>
<div class="section" id="sysvinit-systemd-conversion">
<h3>5.12.7. sysvinit -&gt; systemd conversion<a class="headerlink" href="#sysvinit-systemd-conversion" title="Ссылка на этот заголовок">¶</a></h3>
<p>These instructions apply only for Debian/Ubuntu distros
where both sysvinit and systemd exist.</p>
<p>Install new systemd-enabled packages.</p>
<p>#For each instancename in /etc/tarantool/instances.enabled/: <br />
#To enable the instance to be automatically loaded by systemd: <br />
<code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">enable</span> <span class="pre">tarantool&#64;instancename</span></code></p>
<p>#The following command does nothing but is recommended for consistency: <br />
<code class="docutils literal"><span class="pre">/etc/init.d/tarantool</span> <span class="pre">stop</span></code></p>
<p>#Disable sysvinit-compatible wrappers: <br />
<code class="docutils literal"><span class="pre">systemctl</span> <span class="pre">disable</span> <span class="pre">tarantool;</span> <span class="pre">update-rc.d</span> <span class="pre">tarantool</span> <span class="pre">remove</span></code></p>
</div>
</div>
</div>

  </article>

            
            
            
  
    
      <div class="b-page_over-tail">
    
    
      <div class="b-page_over-prev">
        <a href="app_server.html"
           class="b-prev b-ellipsis"
           title="4. Application server">4. Application server</a>
      </div>
    
    <div class="b-page_over-lang">
      <ul class="b-page_over-lang-list">
        <li class="b-page_over-lang-item">
          <a href="../../_sources/doc/book/administration.txt"
             class="b-page_over-lang-url"> Source </a>
        </li>
      </ul>
    </div>
    
      <div class="b-page_over-next">
        <a href="connectors/index.html"
           class="b-next b-ellipsis"
           title="6. Connectors">6. Connectors</a>
      </div>
    
    </div>
  
</div>
        </div>
      </div>
    
  

      </div>
    </div>
    <!-- FOOTER > -->
    
<footer class="b-footer">
  <div class="b-footer-wrapper">
    <nav class="b-footer_menu">
      
  <ul class="b-menu">
    
      
      <li class="b-menu-item">
      
        <a href="../../index.html" class="b-menu-item-url">Overview</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../try.html" class="b-menu-item-url">Try</a>
      </li>
    
      
      <li class="b-menu-item p-active">
      
        <a href="../../doc.html" class="b-menu-item-url">Documentation</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../download.html" class="b-menu-item-url">Download</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../careers.html" class="b-menu-item-url">Careers</a>
      </li>
    
      
      <li class="b-menu-item">
      
        <a href="../../rocks.html" class="b-menu-item-url">Rocks</a>
      </li>
    
  </ul>

      <div class="b-footer-other">
        <a href="http://15.tarantool.org">1.5 web site and downloads</a>
      </div>
    </nav>
  </div>
</footer>

    <!-- < FOOTER -->
    <div id="mobile-checker"></div>
  </body>
</html>

